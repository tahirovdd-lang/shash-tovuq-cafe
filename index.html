<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>SHASH TOVUQ</title>

<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Yeseva+One&family=Montserrat:wght@500;700;800&display=swap" rel="stylesheet" />

<style>
:root{
  --sand:#fbf7ef;
  --text:#1f1f1f;

  --gold:#D4A017;
  --samarkand:#1f4aa8;
  --green:#1F4D3A;
  --atlas-red:#8B1E1E;

  --card-bg: rgba(255,255,255,.84);
  --line: rgba(0,0,0,.07);
  --shadow: 0 14px 34px rgba(0,0,0,.10);

  --r-lg:26px;
  --r-md:20px;
  --r-sm:16px;
}
body[data-theme="dark"]{
  --sand:#121212;
  --text:#f1f1f1;

  --card-bg: rgba(28,28,28,.90);
  --line: rgba(255,255,255,.12);
  --shadow: 0 18px 44px rgba(0,0,0,.35);
}
*{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
html, body{ width:100%; height:100%; margin:0; padding:0; }
html{ -webkit-text-size-adjust:100%; text-size-adjust:100%; }

body{
  font-family:'Montserrat',sans-serif;
  background:
    radial-gradient(1200px 600px at 50% -120px, rgba(31,74,168,.14), transparent 60%),
    linear-gradient(180deg, #fff, var(--sand));
  color:var(--text);
  padding-bottom:120px; /* ‚úÖ –∑–∞–ø–∞—Å –ø–æ–¥ –Ω–∏–∂–Ω—é—é –∫–æ—Ä–∑–∏–Ω—É */
}

/* ===== header ===== */
.header{
  padding:18px 14px 30px;
  color:#fff;
  position:relative;
  text-align:center;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
  background:
    linear-gradient(180deg, rgba(0,0,0,.56), rgba(0,0,0,.34)),
    url("atlas.jpg") center/cover no-repeat;
  box-shadow: 0 16px 34px rgba(0,0,0,.18);
  border-bottom: 1px solid rgba(255,255,255,.16);
}
.header::after{
  content:"";
  position:absolute;
  inset:0;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  pointer-events:none;
}
.header::before{
  content:"";
  position:absolute;
  left:0; right:0; bottom:0;
  height:16px;
  background: linear-gradient(90deg, rgba(212,160,23,0), rgba(212,160,23,.42), rgba(212,160,23,0));
  opacity:.75;
  pointer-events:none;
}
.header img{
  position:absolute;
  left:10px;
  top:50%;
  transform:translateY(-50%);
  width:88px;
  max-width:30vw;
  height:auto;
  z-index:5;

  padding:8px;
  border-radius:18px;
  background: rgba(255,255,255,.16);
  border: 1px solid rgba(255,255,255,.28);
  box-shadow: 0 14px 30px rgba(0,0,0,.20);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}
.brand-title{
  font-family:'Yeseva One', serif;
  font-size:38px;
  letter-spacing:1px;
  text-transform:uppercase;
  text-shadow: 0 12px 22px rgba(0,0,0,.28);
  position:relative;
  z-index:6;
  line-height:1.0;
  transform: translateX(28px);
}
.brand-sub{ display:none; }
.brand-phone{ position:relative; z-index:50; pointer-events:auto; margin-top:8px; }
.brand-phone a{
  color:#fff;
  text-decoration:none;
  font-size:15px;
  font-weight:900;
  position:relative;
  z-index:51;
  opacity:.95;
}
.geo-btn{
  position:absolute;
  right:14px;
  top:12px;
  width:38px;
  height:38px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  font-weight:900;
  cursor:pointer;
  z-index:80;
  color:#fff;
  background: rgba(255,255,255,.14);
  border:1px solid rgba(255,255,255,.22);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  box-shadow: 0 14px 30px rgba(0,0,0,.18);
  transition:.15s;
}
.geo-btn:active{ transform:scale(.97); }
.search-btn{
  position:absolute;
  right:14px;
  bottom:12px;
  width:38px;
  height:38px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:16px;
  font-weight:900;
  cursor:pointer;
  z-index:60;
  color:#fff;
  background: rgba(255,255,255,.14);
  border:1px solid rgba(255,255,255,.22);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  box-shadow: 0 14px 30px rgba(0,0,0,.18);
  transition:.15s;
}
.search-btn:active{ transform:scale(.97); }
.burger-btn{
  position:absolute;
  right:62px;
  bottom:12px;
  width:38px;
  height:38px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  z-index:65;
  color:#fff;
  background: rgba(255,255,255,.14);
  border:1px solid rgba(255,255,255,.22);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  box-shadow: 0 14px 30px rgba(0,0,0,.18);
  transition:.15s;
}
.burger-btn:active{ transform:scale(.97); }
.burger-ic{ width:18px; height:12px; position:relative; }
.burger-ic span{
  position:absolute; left:0; right:0;
  height:2px; border-radius:8px;
  background:#fff; opacity:.95;
}
.burger-ic span:nth-child(1){ top:0; }
.burger-ic span:nth-child(2){ top:5px; }
.burger-ic span:nth-child(3){ bottom:0; }

/* ===== common ===== */
.langs,.types,.payments{
  display:flex;
  gap:10px;
  padding:12px 12px 6px;
  justify-content:center;
}
.btn{
  padding:12px 16px;
  border-radius:18px;
  font-weight:900;
  min-width:118px;
  text-align:center;
  cursor:pointer;
  transition:.15s;
  border:1px solid var(--line);
  background: rgba(255,255,255,.86);
  box-shadow: 0 10px 24px rgba(0,0,0,.06);
  color:var(--text);
}
.btn:active{ transform:scale(.98); }
.btn.active{
  background: linear-gradient(135deg, var(--samarkand), var(--gold));
  color:#fff;
  border:1px solid rgba(255,255,255,.20);
  box-shadow: 0 14px 30px rgba(31,74,168,.18);
}

.input{
  margin:8px auto;
  display:block;
  padding:14px 14px;
  width:88%;
  border-radius:18px;
  font-size:15px;
  border:1px solid var(--line);
  background: rgba(255,255,255,.90);
  box-shadow: 0 10px 24px rgba(0,0,0,.06);
  outline:none;
  transition:.15s;
  color:var(--text);
}
body[data-theme="dark"] .input{ background: rgba(28,28,28,.90); }
.input:focus{
  border-color: rgba(31,74,168,.35);
  box-shadow: 0 14px 30px rgba(31,74,168,.12);
}

.categories{
  display:flex;
  gap:8px;
  padding:10px 12px 4px;
  overflow-x:auto;
  scroll-behavior:smooth;
}
.categories .btn{
  min-width:122px;
  padding:9px 12px;
  border-radius:16px;
  font-size:13px;
}

.products{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:14px;
  padding:12px;
}
.card{
  border-radius:24px;
  padding:12px 10px;
  text-align:center;
  background: var(--card-bg);
  border:1px solid rgba(0,0,0,.06);
  box-shadow: var(--shadow);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  transition:.15s;
}
body[data-theme="dark"] .card{ border-color: rgba(255,255,255,.10); }
.card:active{ transform:scale(.99); }

.img{ height:104px; display:flex; align-items:center; justify-content:center; }
.img img{ max-width:92px; opacity:.95; }

.price{ font-weight:900; color:var(--atlas-red); margin-top:6px; }
.price small{ font-weight:800; opacity:.75; margin-left:4px; }

.counter{ display:flex; justify-content:center; gap:10px; margin-top:8px; align-items:center; }
.counter button{
  width:34px;
  height:34px;
  border-radius:50%;
  cursor:pointer;
  border:1px solid rgba(255,255,255,.22);
  background: linear-gradient(135deg, var(--samarkand), var(--gold));
  color:white;
  font-size:16px;
  box-shadow: 0 12px 22px rgba(31,74,168,.18);
  transition:.15s;
}
.counter button:active{ transform:scale(.96); }

/* ===== Cart block (–≤–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã) ===== */
.cart{
  background: rgba(255,255,255,.86);
  margin:12px;
  padding:16px;
  border-radius:26px;
  border:1px solid rgba(0,0,0,.06);
  box-shadow: var(--shadow);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}
body[data-theme="dark"] .cart{ background: rgba(28,28,28,.90); border-color: rgba(255,255,255,.10); }

textarea.input{ height:90px; }

/* ‚úÖ order-btn –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç—Å—è ‚Äî –¥–∞–µ–º –Ω–∏–∂–Ω–∏–π –æ—Ç—Å—Ç—É–ø */
.order-btn{
  width:100%;
  padding:18px;
  margin-top:14px;
  margin-bottom:110px; /* ‚úÖ —á—Ç–æ–±—ã –Ω–µ –ø—Ä—è—Ç–∞–ª–∞—Å—å –∑–∞ –Ω–∏–∂–Ω–µ–π –ø–∞–Ω–µ–ª—å—é */
  border-radius:24px;
  cursor:pointer;
  color:white;
  font-size:17px;
  font-weight:900;
  border:1px solid rgba(255,255,255,.18);
  background: linear-gradient(135deg, var(--samarkand), var(--gold));
  box-shadow: 0 18px 36px rgba(31,74,168,.18);
  transition:.15s;
}
.order-btn:active{ transform:scale(.99); }

/* ===== Search ===== */
.search-wrap{
  width:88%;
  margin:8px auto;
  position:relative;
  display:none;
  z-index:70;
}
.search-wrap.show{ display:block; }
.search-wrap input{ width:100%; margin:0; padding-right:44px; }

.search-clear{
  position:absolute;
  right:10px;
  top:50%;
  transform:translateY(-50%);
  width:32px;
  height:32px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  border:1px solid rgba(0,0,0,.08);
  background: rgba(255,255,255,.92);
  box-shadow: 0 10px 22px rgba(0,0,0,.08);
  transition:.15s;
  color:#111;
}
body[data-theme="dark"] .search-clear{ background: rgba(28,28,28,.92); border-color: rgba(255,255,255,.10); color:#f1f1f1; }
.search-clear:active{ transform:translateY(-50%) scale(.96); }

.search-title{
  width:88%;
  margin:10px auto 0;
  font-weight:900;
  opacity:.92;
  display:none;
  z-index:70;
  position:relative;
}
.search-title.show{ display:block; }

mark{ background:rgba(212,160,23,.28); padding:0 .14em; border-radius:8px; }

/* ===== Popular ===== */
.popular-wrap{ width:100%; padding:4px 12px 4px; }
.popular-title{
  width:100%;
  font-weight:900;
  padding:8px 2px 10px;
  display:flex;
  align-items:center;
  gap:8px;
}
.popular-row{ display:flex; gap:12px; overflow-x:auto; padding:2px 2px 10px; }
.pop-card{
  min-width:180px;
  border-radius:24px;
  padding:12px;
  background: var(--card-bg);
  border:1px solid rgba(0,0,0,.06);
  box-shadow: var(--shadow);
  cursor:pointer;
  transition:.15s;
  position:relative;
  overflow:hidden;
}
body[data-theme="dark"] .pop-card{ border-color: rgba(255,255,255,.10); }
.pop-card:active{ transform:scale(.99); }
.pop-img{
  height:110px;
  border-radius:18px;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
  background: rgba(31,74,168,.10);
}
.pop-img img{ width:100%; height:100%; object-fit:cover; }
.pop-name{ font-weight:900; margin-top:10px; }
.pop-price{ font-weight:900; color:var(--atlas-red); margin-top:6px; }
.pop-badge{ position:absolute; left:10px; top:10px; font-size:18px; pointer-events:none; }

/* ‚úÖ –≤–º–µ—Å—Ç–æ ‚Äú–æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑‚Äù –≤–Ω–∏–∑—É ‚Äî –ö–û–†–ó–ò–ù–ê */
.sticky-checkout{
  position:fixed;
  left:0; right:0; bottom:0;
  padding:10px 12px env(safe-area-inset-bottom);
  background: rgba(251,247,239,.72);
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
  z-index:999;
  border-top:1px solid rgba(0,0,0,.06);
}
body[data-theme="dark"] .sticky-checkout{ background: rgba(18,18,18,.72); border-top-color: rgba(255,255,255,.10); }

.sticky-inner{
  max-width:520px;
  margin:0 auto;
  border-radius:20px;
  padding:10px 12px;
  background: rgba(255,255,255,.88);
  border:1px solid rgba(0,0,0,.06);
  box-shadow: 0 16px 34px rgba(0,0,0,.10);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}
body[data-theme="dark"] .sticky-inner{ background: rgba(28,28,28,.88); border-color: rgba(255,255,255,.10); }

.sticky-sum{ font-weight:900; line-height:1.1; }
.sticky-sum small{ display:block; font-weight:800; opacity:.70; margin-top:2px; }

/* ‚úÖ –ö–Ω–æ–ø–∫–∞ —Ç–µ–ø–µ—Ä—å ‚Äú–ö–æ—Ä–∑–∏–Ω–∞‚Äù, –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç –Ω–∏—á–µ–≥–æ –∏ –≤–µ–¥—ë—Ç –∫ –±–ª–æ–∫—É cart */
.sticky-btn{
  padding:12px 14px;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.18);
  background: linear-gradient(135deg, var(--samarkand), var(--gold));
  color:#fff;
  font-weight:900;
  cursor:pointer;
  box-shadow: 0 16px 34px rgba(31,74,168,.16);
  transition:.15s;
  white-space:nowrap;
}
.sticky-btn:active{ transform:scale(.99); }

/* ===== Burger sheet ===== */
.menu-backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.40);
  opacity:0;
  pointer-events:none;
  transition:.18s;
  z-index:2000;
}
.menu-backdrop.show{ opacity:1; pointer-events:auto; }

.menu-sheet{
  position:fixed;
  left:0; right:0;
  bottom:-120%;
  z-index:2010;
  transition:.22s;
  padding:10px 12px 14px;
  background: rgba(255,255,255,.92);
  border-top-left-radius:24px;
  border-top-right-radius:24px;
  border:1px solid rgba(0,0,0,.08);
  box-shadow: 0 18px 48px rgba(0,0,0,.22);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
}
body[data-theme="dark"] .menu-sheet{
  background: rgba(28,28,28,.92);
  border-color: rgba(255,255,255,.10);
}
.menu-sheet.show{ bottom:0; }

.menu-handle{
  width:44px;
  height:5px;
  border-radius:999px;
  background:rgba(0,0,0,.18);
  margin:6px auto 10px;
}
body[data-theme="dark"] .menu-handle{ background:rgba(255,255,255,.18); }

.menu-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:2px 4px 10px;
}
.menu-head b{ font-size:16px; }
.menu-close{
  width:38px;height:38px;
  border:none;
  border-radius:12px;
  background:transparent;
  cursor:pointer;
  font-size:22px;
  line-height:1;
  color:#777;
}
body[data-theme="dark"] .menu-close{ color:#bbb; }

.menu-list{ display:flex; flex-direction:column; gap:8px; }

.menu-item{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:12px;
  border-radius:18px;
  border:1px solid rgba(0,0,0,.08);
  background: rgba(0,0,0,.03);
  cursor:pointer;
  text-decoration:none;
  color:var(--text);
}
body[data-theme="dark"] .menu-item{
  border-color: rgba(255,255,255,.10);
  background: rgba(255,255,255,.06);
}

.menu-left{ display:flex; align-items:center; gap:10px; min-width:0; }
.menu-ic{
  width:32px; height:32px;
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  background: rgba(0,0,0,.06);
  flex:0 0 auto;
}
body[data-theme="dark"] .menu-ic{ background: rgba(255,255,255,.06); }
.menu-txt{ display:flex; flex-direction:column; min-width:0; }
.menu-name{ font-weight:900; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.menu-sub{ font-size:12px; opacity:.75; margin-top:2px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.menu-right{ opacity:.65; font-weight:900; }

.review-wrap{ display:none; padding:6px 4px 10px; }
.review-card{
  border:1px solid rgba(0,0,0,.08);
  border-radius:18px;
  overflow:hidden;
  background:#fff;
  padding:10px;
  display:flex;
  justify-content:center;
}
body[data-theme="dark"] .review-card{ background:#0f0f0f; border-color: rgba(255,255,255,.10); }

.about-modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  display:none;
  z-index:2100;
  padding:18px 14px;
}
.about-modal.show{ display:block; }
.about-card{
  max-width:760px;
  margin:0 auto;
  background: rgba(255,255,255,.92);
  border:1px solid rgba(0,0,0,.08);
  border-radius:24px;
  box-shadow: 0 18px 54px rgba(0,0,0,.22);
  padding:14px 14px 12px;
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
}
body[data-theme="dark"] .about-card{
  background: rgba(28,28,28,.92);
  border-color: rgba(255,255,255,.10);
}
.about-head{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:6px; }
.about-head b{ font-size:16px; }
.about-body{ font-size:14px; line-height:1.45; white-space:pre-wrap; }
.about-tabs{
  display:flex;
  gap:10px;
  margin:10px 0 12px;
  overflow-x:auto;
}
.tabbtn{
  padding:10px 14px;
  border-radius:999px;
  border:1px solid rgba(0,0,0,.08);
  background: rgba(0,0,0,.03);
  font-weight:900;
  cursor:pointer;
  white-space:nowrap;
  color:var(--text);
}
body[data-theme="dark"] .tabbtn{
  border-color: rgba(255,255,255,.10);
  background: rgba(255,255,255,.06);
}
.tabbtn.active{
  background: linear-gradient(135deg, var(--samarkand), var(--gold));
  border:1px solid rgba(255,255,255,.20);
  color:#fff;
}
.small-note{ opacity:.75; font-size:12px; margin-top:6px; }

.legal-modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  display:none;
  z-index:2200;
  padding:18px 14px;
}
.legal-modal.show{ display:block; }
.legal-card{
  max-width:760px;
  margin:0 auto;
  background: rgba(255,255,255,.92);
  border:1px solid rgba(0,0,0,.08);
  border-radius:24px;
  box-shadow: 0 18px 54px rgba(0,0,0,.22);
  padding:14px 14px 12px;
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
}
body[data-theme="dark"] .legal-card{
  background: rgba(28,28,28,.92);
  border-color: rgba(255,255,255,.10);
}
.legal-actions{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-top:12px;
}
.legal-actions .tabbtn{ flex:1 1 auto; }

@media (max-width:380px){
  .brand-title{ font-size:32px; transform: translateX(22px); }
  .header img{ width:76px; padding:7px; border-radius:16px; }
  .geo-btn,.burger-btn,.search-btn{ width:36px; height:36px; }
  .products{ gap:12px; }
  .img{ height:96px; }
  .img img{ max-width:86px; }
  .categories .btn{ min-width:116px; font-size:12.6px; padding:8px 10px; }
}
</style>
</head>

<body data-theme="light">

<div class="header">
  <img src="logo.png" onerror="this.src='logo.png'">
  <div style="position:relative; z-index:6;">
    <div class="brand-title">SHASH TOVUQ</div>
    <div class="brand-sub"></div>
    <div class="brand-phone">
      <a href="tel:+998992711925" onclick="callPhone(event)">+998 99 271 19 25</a>
    </div>
  </div>

  <div class="geo-btn" onclick="openMap()" title="–ú–∞—Ä—à—Ä—É—Ç">üìç</div>

  <div class="burger-btn" onclick="openTopMenu()" title="–ú–µ–Ω—é">
    <div class="burger-ic"><span></span><span></span><span></span></div>
  </div>

  <div class="search-btn" onclick="toggleSearch()">üîç</div>
</div>

<div class="search-title" id="searchTitle">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</div>
<div class="search-wrap" id="searchWrap">
  <input id="searchInput" class="input" placeholder="–ü–æ–∏—Å–∫ –±–ª—é–¥–∞..." oninput="searchProducts()" onkeydown="onSearchKey(event)">
  <div class="search-clear" onclick="clearSearch()" title="–û—á–∏—Å—Ç–∏—Ç—å">‚úñ</div>
</div>

<div class="langs">
  <button class="btn active" onclick="setLang('ru',this)">RU</button>
  <button class="btn" onclick="setLang('uz',this)">UZ</button>
  <button class="btn" onclick="setLang('en',this)">EN</button>
</div>

<div class="popular-wrap" id="popularWrap">
  <div class="popular-title" id="popularTitle">üî• –ü–æ–ø—É–ª—è—Ä–Ω–æ–µ</div>
  <div class="popular-row" id="popularRow"></div>
</div>

<div class="types">
  <button class="btn active" id="btnDelivery" onclick="setType('delivery',this)"></button>
  <button class="btn" id="btnPickup" onclick="setType('pickup',this)"></button>
</div>

<input id="address" class="input">
<input id="phone" class="input">

<div class="categories" id="cats"></div>
<div class="products" id="products"></div>

<!-- ‚úÖ –Ø–∫–æ—Ä—å –¥–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –∏–∑ –Ω–∏–∂–Ω–µ–π ‚Äú–ö–æ—Ä–∑–∏–Ω—ã‚Äù -->
<div id="cartAnchor"></div>

<div class="cart" id="cartBlock">
  <b id="cartTitle"></b>: <span id="total">0</span> —Å—É–º
  <textarea id="comment" class="input"></textarea>
  <div class="payments">
    <button class="btn active" id="payCash" onclick="setPayment('cash')"></button>
    <button class="btn" id="payClick" onclick="setPayment('click')"></button>
  </div>
  <button class="order-btn" id="orderBtn" onclick="sendOrder()"></button>
</div>

<div class="sticky-checkout">
  <div class="sticky-inner">
    <div class="sticky-sum">
      <span id="stickyTotal">0</span> <small>—Å—É–º</small>
    </div>
    <button class="sticky-btn" onclick="scrollToCart()" id="stickyCart">üõí –ö–æ—Ä–∑–∏–Ω–∞</button>
  </div>
</div>

<div class="menu-backdrop" id="menuBackdrop" onclick="closeTopMenu()"></div>

<div class="menu-sheet" id="menuSheet" role="dialog" aria-modal="true">
  <div class="menu-handle"></div>
  <div class="menu-head">
    <b id="menuTitle">–ú–µ–Ω—é</b>
    <button class="menu-close" onclick="closeTopMenu()">√ó</button>
  </div>

  <div class="menu-list">
    <div class="menu-item" onclick="toggleReviewWidget()" role="button">
      <div class="menu-left">
        <div class="menu-ic">‚≠ê</div>
        <div class="menu-txt">
          <div class="menu-name" id="mReviewTitle">–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</div>
          <div class="menu-sub" id="mReviewSub">–Ø–Ω–¥–µ–∫—Å —Ä–µ–π—Ç–∏–Ω–≥ / –æ—Ç–∑—ã–≤—ã</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </div>

    <div class="review-wrap" id="reviewWidgetWrap">
      <div class="review-card">
        <iframe src="https://yandex.ru/sprav/widget/rating-badge/23178318202?type=rating" width="150" height="50" frameborder="0" style="border:0; display:block;"></iframe>
      </div>
      <div class="small-note" id="mReviewHint">
        –ï—Å–ª–∏ –≤–∏–¥–∂–µ—Ç –Ω–µ –æ—Ç–∫—Ä—ã–ª—Å—è –≤ Telegram ‚Äî –Ω–∞–∂–º–∏ ¬´–û—Ç–∫—Ä—ã—Ç—å –æ—Ç–∑—ã–≤—ã¬ª.
      </div>
      <div style="display:flex; justify-content:center; margin-top:8px;">
        <button class="tabbtn" id="mOpenReviewsBtn" onclick="openYandexReviews(event)">–û—Ç–∫—Ä—ã—Ç—å –æ—Ç–∑—ã–≤—ã</button>
      </div>
    </div>

    <div class="menu-item" onclick="openLegal()" role="button">
      <div class="menu-left">
        <div class="menu-ic">üè¢</div>
        <div class="menu-txt">
          <div class="menu-name" id="mLegalTitle">–î–ª—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü</div>
          <div class="menu-sub" id="mLegalSub">–°–≤—è–∑–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </div>

    <a class="menu-item" href="tel:+998992711925" onclick="closeTopMenu()">
      <div class="menu-left">
        <div class="menu-ic">üìû</div>
        <div class="menu-txt">
          <div class="menu-name" id="mCallTitle">–ü–æ–∑–≤–æ–Ω–∏—Ç—å</div>
          <div class="menu-sub">+998 99 271 19 25</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </a>

    <a class="menu-item" href="#" onclick="openInstagram(event)">
      <div class="menu-left">
        <div class="menu-ic">üì∑</div>
        <div class="menu-txt">
          <div class="menu-name" id="mInstaTitle">@shashtovuq</div>
          <div class="menu-sub" id="mInstaSub">–û—Ç–∫—Ä—ã—Ç—å Instagram</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </a>

    <div class="menu-item" onclick="toggleThemeFromMenu()" role="button">
      <div class="menu-left">
        <div class="menu-ic">üåì</div>
        <div class="menu-txt">
          <div class="menu-name" id="mThemeTitle">–¢–µ–º–∞</div>
          <div class="menu-sub" id="themeMenuSub">–°–≤–µ—Ç–ª–∞—è</div>
        </div>
      </div>
      <div class="menu-right" id="mThemeAction">–°–º–µ–Ω–∏—Ç—å</div>
    </div>

    <div class="menu-item" onclick="openAbout()" role="button">
      <div class="menu-left">
        <div class="menu-ic">‚ÑπÔ∏è</div>
        <div class="menu-txt">
          <div class="menu-name" id="mAboutTitle">–û –Ω–∞—Å</div>
          <div class="menu-sub" id="mAboutSub">–ê–¥—Ä–µ—Å –∏ –æ–ø–∏—Å–∞–Ω–∏–µ</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </div>
  </div>
</div>

<div class="about-modal" id="aboutModal" onclick="aboutBackdropClick(event)">
  <div class="about-card">
    <div class="about-head">
      <b id="aboutTitle">–û –Ω–∞—Å</b>
      <button class="menu-close" onclick="closeAbout()">√ó</button>
    </div>

    <div class="about-tabs">
      <button class="tabbtn active" id="tabRu" onclick="setAboutLang('ru')">üá∑üá∫ RU</button>
      <button class="tabbtn" id="tabUz" onclick="setAboutLang('uz')">üá∫üáø UZ</button>
      <button class="tabbtn" id="tabEn" onclick="setAboutLang('en')">üá¨üáß EN</button>
    </div>

    <div class="about-body" id="aboutBody"></div>
  </div>
</div>

<div class="legal-modal" id="legalModal" onclick="legalBackdropClick(event)">
  <div class="legal-card">
    <div class="about-head">
      <b id="legalTitle">–î–ª—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü</b>
      <button class="menu-close" onclick="closeLegal()">√ó</button>
    </div>
    <div class="about-body" id="legalBody"></div>

    <div class="legal-actions">
      <button class="tabbtn" onclick="contactManager()">–°–≤—è–∑–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º</button>
      <button class="tabbtn" onclick="openTelLegal()">–ü–æ–∑–≤–æ–Ω–∏—Ç—å</button>
      <button class="tabbtn" onclick="openMailLegal()">–ü–æ—á—Ç–∞</button>
    </div>
  </div>
</div>

<script>
Telegram.WebApp.ready();
Telegram.WebApp.expand?.();

const $ = (id)=>document.getElementById(id);

const PHONE_TEL  = "tel:+998992711925";
const IG_URL = "https://www.instagram.com/shashtovuq/";
const YANDEX_WIDGET_URL = "https://yandex.ru/sprav/widget/rating-badge/23178318202?type=rating";
const MAP_URL = "https://yandex.uz/maps/org/23178318202/?ll=66.950144%2C39.645189&z=16.65";

const LEGAL_PHONE = "+998 91 319 70 07";
const LEGAL_MAIL  = "shashtovuq@gmail.com";
const ADMIN_TG_ID = "6013591658";

function openMap(){
  try{ Telegram.WebApp.openLink(MAP_URL); }
  catch(_){ window.open(MAP_URL, "_blank"); }
}

const MENU_I18N = {
  ru:{menu:'–ú–µ–Ω—é',review_title:'–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤',review_sub:'–Ø–Ω–¥–µ–∫—Å —Ä–µ–π—Ç–∏–Ω–≥ / –æ—Ç–∑—ã–≤—ã',review_hint:'–ï—Å–ª–∏ –≤–∏–¥–∂–µ—Ç –Ω–µ –æ—Ç–∫—Ä—ã–ª—Å—è –≤ Telegram ‚Äî –Ω–∞–∂–º–∏ ¬´–û—Ç–∫—Ä—ã—Ç—å –æ—Ç–∑—ã–≤—ã¬ª.',open_reviews:'–û—Ç–∫—Ä—ã—Ç—å –æ—Ç–∑—ã–≤—ã',call:'–ü–æ–∑–≤–æ–Ω–∏—Ç—å',insta_sub:'–û—Ç–∫—Ä—ã—Ç—å Instagram',theme:'–¢–µ–º–∞',theme_light:'–°–≤–µ—Ç–ª–∞—è',theme_dark:'–¢—ë–º–Ω–∞—è',theme_action:'–°–º–µ–Ω–∏—Ç—å',about:'–û –Ω–∞—Å',about_sub:'–ê–¥—Ä–µ—Å –∏ –æ–ø–∏—Å–∞–Ω–∏–µ',about_title:'–û –Ω–∞—Å',legal_title:'–î–ª—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü',legal_sub:'–°–≤—è–∑–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º'},
  uz:{menu:'Menyu',review_title:'Fikr qoldirish',review_sub:'Yandex reyting / fikrlar',review_hint:'Agar vidjet Telegramda ochilmasa ‚Äî ¬´Sharhlarni ochish¬ªni bosing.',open_reviews:"Sharhlarni ochish",call:"Qo'ng'iroq qilish",insta_sub:"Instagramni ochish",theme:"Mavzu",theme_light:"Yorug'",theme_dark:"Qorong'i",theme_action:"Almashtirish",about:"Biz haqimizda",about_sub:"Manzil va ma'lumot",about_title:"Biz haqimizda",legal_title:"Yuridik shaxslar uchun",legal_sub:"Menejer bilan bog'lanish"},
  en:{menu:'Menu',review_title:'Leave a review',review_sub:'Yandex rating / reviews',review_hint:'If the widget doesn‚Äôt open in Telegram ‚Äî tap ‚ÄúOpen reviews‚Äù.',open_reviews:'Open reviews',call:'Call',insta_sub:'Open Instagram',theme:'Theme',theme_light:'Light',theme_dark:'Dark',theme_action:'Switch',about:'About us',about_sub:'Address and info',about_title:'About us',legal_title:'For legal entities',legal_sub:'Contact manager'}
};

const ABOUT_TEXT = {
  ru:`üá∑üá∫ –û –Ω–∞—Å

Fast Food SHASH TOVUQ ‚Äî –±—ã—Å—Ç—Ä–æ, –≤–∫—É—Å–Ω–æ –∏ —Å –¥—É—à–æ–π üî•üêî
–ì–æ—Ç–æ–≤–∏–º —Å–æ—á–Ω—É—é –∫—É—Ä–∏—Ü—É, —à–∞—à–ª—ã–∫, –±—É—Ä–≥–µ—Ä—ã –∏ –ª—é–±–∏–º—ã–µ —Ñ–∞—Å—Ç—Ñ—É–¥-–±–ª—é–¥–∞ –∏–∑ —Å–≤–µ–∂–∏—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤.

–ó–∞–±—Ä–∞—Ç—å —Å —Å–æ–±–æ–π –∏–ª–∏ –∑–∞–∫–∞–∑–∞—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É ‚Äî –≤—ã–±–∏—Ä–∞–π –∫–∞–∫ —É–¥–æ–±–Ω–æ.
SHASH TOVUQ ‚Äî –∫–æ–≥–¥–∞ —Ö–æ—á–µ—Ç—Å—è –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É –≤–∫—É—Å–Ω–æ!

üìç –°–∞–º–∞—Ä–∫–∞–Ω–¥
(—É–∫–∞–∂–∏ –∞–¥—Ä–µ—Å –∑–¥–µ—Å—å)`,
  uz:`üá∫üáø Biz haqimizda

Fast Food SHASH TOVUQ ‚Äî tez, mazali va chin dildan üî•üêî
Biz shirali tovuq, shashlik, burger va sevimli fastfud taomlarini yangi mahsulotlardan tayyorlaymiz.

Olib ketish yoki yetkazib berish ‚Äî o'zingizga qulayini tanlang.
SHASH TOVUQ ‚Äî haqiqiy mazani xohlaganda!

üìç Samarqand
(manzilni shu yerga yozing)`,
  en:`üá¨üáß About Us

Fast Food SHASH TOVUQ ‚Äî fast, tasty, and made with care üî•üêî
We cook juicy chicken, shashlik, burgers and your favorite fast food using fresh ingredients.

Pickup or delivery ‚Äî choose what‚Äôs convenient.
SHASH TOVUQ ‚Äî when you want it truly delicious!

üìç Samarkand
(add your address here)`
};

const TEXT={
  ru:{delivery:'üöö –î–æ—Å—Ç–∞–≤–∫–∞',pickup:'üèÉ –°–∞–º–æ–≤—ã–≤–æ–∑',address:'üìç –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏',phone:'üìû –¢–µ–ª–µ—Ñ–æ–Ω',cart:'üõí –ö–æ—Ä–∑–∏–Ω–∞',order:'–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑',comment:'‚úçÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É',cash:'üíµ –ù–∞–ª–∏—á–Ω—ã–µ',click:'üí≥ CLICK',results:'–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞',popular:'üî• –ü–æ–ø—É–ª—è—Ä–Ω–æ–µ',empty:'–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è',cart_btn:'üõí –ö–æ—Ä–∑–∏–Ω–∞'},
  uz:{delivery:'üöö Yetkazish',pickup:'üèÉ Olib ketish',address:'üìç Manzil',phone:'üìû Telefon',cart:'üõí Savat',order:'Buyurtma berish',comment:'‚úçÔ∏è Izoh',cash:'üíµ Naqd',click:'üí≥ CLICK',results:'Qidiruv natijalari',popular:'üî• Ommabop',empty:'Savat bo‚Äòsh',cart_btn:'üõí Savat'},
  en:{delivery:'üöö Delivery',pickup:'üèÉ Pickup',address:'üìç Address',phone:'üìû Phone',cart:'üõí Cart',order:'Place order',comment:'‚úçÔ∏è Comment',cash:'üíµ Cash',click:'üí≥ CLICK',results:'Search results',popular:'üî• Popular',empty:'Cart is empty',cart_btn:'üõí Cart'}
};

/* ‚úÖ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—Å—Ç–∞–≤–∏–ª –∫–∞–∫ –±—ã–ª–∏ ‚Äî –ø–æ—Ç–æ–º –ø–æ–¥ fast food –∑–∞–º–µ–Ω–∏–º –º–µ–Ω—é/–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ */
const CATS={
  ru:{salads:'ü•ó –°–∞–ª–∞—Ç—ã',cold:'ü•í –•–æ–ª–æ–¥–Ω—ã–µ –∑–∞–∫—É—Å–∫–∏',first:'üçú –ü–µ—Ä–≤—ã–µ –±–ª—é–¥–∞',second:'üç≤ –í—Ç–æ—Ä—ã–µ –±–ª—é–¥–∞',drinks:'ü•§ –ù–∞–ø–∏—Ç–∫–∏',water:'üíß –ú–∏–Ω–µ—Ä–∞–ª—å–Ω–∞—è –≤–æ–¥–∞',energy:'‚ö° Energy drinks'},
  uz:{salads:'ü•ó Salatlar',cold:'ü•í Sovuq zakuskalar',first:'üçú Birinchi taomlar',second:'üç≤ Ikkinchi taomlar',drinks:'ü•§ Ichimliklar',water:'üíß Mineral suv',energy:'‚ö° Energetik ichimliklar'},
  en:{salads:'ü•ó Salads',cold:'ü•í Cold snacks',first:'üçú First dishes',second:'üç≤ Main dishes',drinks:'ü•§ Drinks',water:'üíß Mineral water',energy:'‚ö° Energy drinks'}
};

const MENU = {
  salads:[
    {id:'chalop', p:15000, img:'images/chalop.jpg', n:{ru:'–ß–∞–ª–æ–ø', uz:'Chalop', en:'Chalop'}},
    {id:'achichuk', p:15000, img:'images/achichuk.jpg', n:{ru:'–ê—á–∏—á—É–∫', uz:"Achichuk", en:'Achichuk'}},
    {id:'svezhiy', p:15000, img:'images/svezhiy.jpg', n:{ru:'–°–≤–µ–∂–∏–π', uz:'Yangi salat', en:'Fresh salad'}}
  ],
  cold:[
    {id:'chakka_zelen_rediska', p:15000, img:'images/chakka_zelen_rediska.jpg', n:{ru:'–ß–∞–∫–∫–∞ (–°—é–∑—å–º–∞) —Å –∑–µ–ª–µ–Ω—å—é –∏ —Ä–µ–¥–∏—Å–∫–æ–π', uz:"Chakka (Suyzma) ko\'kat va redis bilan", en:'Chakka (Suzma) with herbs & radish'}},
    {id:'chakka_perets', p:12000, img:'images/chakka_perets.jpg', n:{ru:'–ß–∞–∫–∫–∞ (–°—é–∑—å–º–∞) —Å –ø–µ—Ä—Ü–µ–º', uz:"Chakka (Suyzma) murch bilan", en:'Chakka (Suzma) with pepper'}},
    {id:'chakka_zelen', p:12000, img:'images/chakka_zelen.jpg', n:{ru:'–ß–∞–∫–∫–∞ (–°—é–∑—å–º–∞) —Å –∑–µ–ª–µ–Ω—å—é', uz:"Chakka (Suyzma) ko\'kat bilan", en:'Chakka (Suzma) with herbs'}},
    {id:'chakka', p:10000, img:'images/chakka.jpg', n:{ru:'–ß–∞–∫–∫–∞ (–°—é–∑—å–º–∞)', uz:"Chakka (Suyzma)", en:'Chakka (Suzma)'}},
    {id:'zelen_assorti', p:20000, img:'images/zelen_assorti.jpg', n:{ru:'–ó–µ–ª–µ–Ω—å –∞—Å—Å–æ—Ä—Ç–∏', uz:"Ko\'kat assorti", en:'Herbs assortment'}},
    {id:'luk_anzur', p:15000, img:'images/luk_anzur.jpg', n:{ru:'–õ—É–∫ –ê–Ω–∑—É—Ä', uz:'Anzur piyoz', en:'Anzur onion'}},
    {id:'solenya_assorti', p:25000, img:'images/solenya_assorti.jpg', n:{ru:'–°–æ–ª–µ–Ω—å—è –∞—Å—Å–æ—Ä—Ç–∏', uz:"Tuzlama assorti", en:'Pickles assortment'}},
    {id:'marin_pomidory', p:15000, img:'images/marin_pomidory.jpg', n:{ru:'–ú–∞—Ä–∏–Ω–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–º–∏–¥–æ—Ä—ã', uz:"Marinad pomidor", en:'Pickled tomatoes'}},
    {id:'marin_ogurcy', p:15000, img:'images/marin_ogurcy.jpg', n:{ru:'–ú–∞—Ä–∏–Ω–æ–≤–∞–Ω–Ω—ã–µ –æ–≥—É—Ä—Ü—ã', uz:"Marinad bodring", en:'Pickled cucumbers'}}
  ],
  first:[
    {id:'govyazhiy_bulon', p:60000, img:'images/govyazhiy_bulon.jpg', n:{ru:'–ì–æ–≤—è–∂–∏–π –±—É–ª—å–æ–Ω', uz:"Mol bulyon", en:'Beef broth'}},
    {id:'lagman', p:50000, img:'images/lagman.jpg', n:{ru:'–õ–∞–≥–º–∞–Ω', uz:"Lag\'mon", en:'Lagman'}},
    {id:'shurpa', p:50000, img:'images/shurpa.jpg', n:{ru:'–®—É—Ä–ø–∞', uz:"Sho\'rva", en:'Shurpa'}}
  ],
  second:[
    {id:'zharenyy_lagman', p:60000, img:'images/zharenyy_lagman.jpg', n:{ru:'–ñ–∞—Ä–µ–Ω–Ω—ã–π –ª–∞–≥–º–∞–Ω', uz:"Qovurilgan lag\'mon", en:'Fried lagman'}},
    {id:'kalla_pocha', p:70000, img:'images/kalla_pocha.jpg', n:{ru:'–ö–∞–ª–∞ –ü–æ—á–∞', uz:"Kalla pocha", en:'Kalla pocha'}},
    {id:'halisa', p:70000, img:'images/halisa.jpg', n:{ru:'–•–∞–ª–∏—Å–∞', uz:'Halisa', en:'Halisa'}},
    {id:'plov_05', p:50000, img:'images/plov_05.jpg', n:{ru:'–ü–ª–æ–≤ 0.5', uz:'Osh 0.5', en:'Plov 0.5'}}
  ],
  drinks:[
    {id:'fanta_025', p:7000, img:'images/fanta_025.jpg', n:{ru:'Fanta 0.25L', uz:'Fanta 0.25L', en:'Fanta 0.25L'}},
    {id:'sprite_1', p:15000, img:'images/sprite_1.jpg', n:{ru:'Sprite 1L', uz:'Sprite 1L', en:'Sprite 1L'}},
    {id:'fanta_15', p:20000, img:'images/fanta_15.jpg', n:{ru:'Fanta 1.5L', uz:'Fanta 1.5L', en:'Fanta 1.5L'}},
    {id:'fanta_1', p:15000, img:'images/fanta_1.jpg', n:{ru:'Fanta 1L', uz:'Fanta 1L', en:'Fanta 1L'}},
    {id:'bliss_1', p:18000, img:'images/bliss_1.jpg', n:{ru:'–°–æ–∫ Bliss –≤ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–µ 1L', uz:"Bliss sharbat 1L (assort)", en:'Bliss juice assorted 1L'}},
    {id:'cola_15', p:20000, img:'images/cola_15.jpg', n:{ru:'Coca Cola 1.5L', uz:'Coca Cola 1.5L', en:'Coca Cola 1.5L'}},
    {id:'cola_1', p:15000, img:'images/cola_1.jpg', n:{ru:'Coca Cola 1L', uz:'Coca Cola 1L', en:'Coca Cola 1L'}},
    {id:'ice_tea_125', p:15000, img:'images/ice_tea_125.jpg', n:{ru:'Ice Tea 1.25L', uz:'Ice Tea 1.25L', en:'Ice Tea 1.25L'}},
    {id:'pepsi_1', p:15000, img:'images/pepsi_1.jpg', n:{ru:'Pepsi 1L', uz:'Pepsi 1L', en:'Pepsi 1L'}},
    {id:'lipton_1', p:15000, img:'images/lipton_1.jpg', n:{ru:'Lipton 1L', uz:'Lipton 1L', en:'Lipton 1L'}},
    {id:'pepsi_025', p:10000, img:'images/pepsi_025.jpg', n:{ru:'Pepsi 0.25L', uz:'Pepsi 0.25L', en:'Pepsi 0.25L'}},
    {id:'pepsi_05', p:12000, img:'images/pepsi_05.jpg', n:{ru:'Pepsi 0.5L', uz:'Pepsi 0.5L', en:'Pepsi 0.5L'}},
    {id:'pepsi_15', p:20000, img:'images/pepsi_15.jpg', n:{ru:'Pepsi 1.5L', uz:'Pepsi 1.5L', en:'Pepsi 1.5L'}}
  ],
  water:[
    {id:'montella_15', p:10000, img:'images/montella_15.jpg', n:{ru:'–í–æ–¥–∞ Montella 1.5L', uz:'Montella 1.5L', en:'Montella 1.5L'}},
    {id:'montella_1', p:7000, img:'images/montella_1.jpg', n:{ru:'–í–æ–¥–∞ Montella 1L', uz:'Montella 1L', en:'Montella 1L'}},
    {id:'chortoq_05', p:15000, img:'images/chortoq_05.jpg', n:{ru:'–ú–∏–Ω–µ—Ä–∞–ª—å–Ω–∞—è –≤–æ–¥–∞ Chortoq 0.5L', uz:'Chortoq 0.5L', en:'Chortoq mineral water 0.5L'}},
    {id:'montella_05', p:5000, img:'images/montella_05.jpg', n:{ru:'–í–æ–¥–∞ Montella 0.5L', uz:'Montella 0.5L', en:'Montella 0.5L'}}
  ],
  energy:[
    {id:'18plus_05', p:15000, img:'images/18plus_05.jpg', n:{ru:'18+ 0.5L', uz:'18+ 0.5L', en:'18+ 0.5L'}},
    {id:'18plus_033', p:12000, img:'images/18plus_033.jpg', n:{ru:'18+ 0.33L', uz:'18+ 0.33L', en:'18+ 0.33L'}},
    {id:'18plus_025', p:10000, img:'images/18plus_025.jpg', n:{ru:'18+ 0.25L', uz:'18+ 0.25L', en:'18+ 0.25L'}},
    {id:'adrenaline_049', p:15000, img:'images/adrenaline_049.jpg', n:{ru:'Adrenaline 0.49L', uz:'Adrenaline 0.49L', en:'Adrenaline 0.49L'}},
    {id:'adrenaline_025', p:12000, img:'images/adrenaline_025.jpg', n:{ru:'Adrenaline 0.25L', uz:'Adrenaline 0.25L', en:'Adrenaline 0.25L'}}
  ]
};

const POPULAR_IDS = ['plov_05','lagman','shurpa','achichuk'];
const ITEM_BY_ID = {};
for (const cat in MENU){ for (const it of MENU[cat]) ITEM_BY_ID[it.id] = it; }

function formatSum(x){
  const n = Number(x) || 0;
  return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,' ');
}
function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}
function highlight(text, q){
  const safe = escapeHtml(text);
  if(!q) return safe;
  const lower = safe.toLowerCase();
  const idx = lower.indexOf(q.toLowerCase());
  if(idx === -1) return safe;
  return safe.slice(0,idx) + `<mark>${safe.slice(idx, idx+q.length)}</mark>` + safe.slice(idx+q.length);
}

const tgUser = Telegram.WebApp.initDataUnsafe?.user || {};
const tg_username = tgUser.username || "";
const tg_first_name = tgUser.first_name || "";
const tg_id = tgUser.id || "";

function openTopMenu(){ $('menuBackdrop').classList.add('show'); $('menuSheet').classList.add('show'); }
function closeTopMenu(){ $('menuBackdrop').classList.remove('show'); $('menuSheet').classList.remove('show'); }

function toggleReviewWidget(){
  const w = $('reviewWidgetWrap');
  w.style.display = (!w.style.display || w.style.display === 'none') ? 'block' : 'none';
}
function openYandexReviews(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  try{ Telegram.WebApp.openLink(YANDEX_WIDGET_URL); }
  catch(_){ window.open(YANDEX_WIDGET_URL, "_blank"); }
}
function openInstagram(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  closeTopMenu();
  try{ Telegram.WebApp.openLink(IG_URL); }
  catch(_){ window.open(IG_URL, "_blank"); }
}
function callPhone(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  try{ Telegram.WebApp.openLink(PHONE_TEL); }
  catch(_){ window.location.href = PHONE_TEL; }
}

function openLegal(){
  closeTopMenu();
  const t = MENU_I18N[lang] || MENU_I18N.ru;
  $('legalTitle').innerText = t.legal_title || '–î–ª—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü';

  const body = {
    ru:`–°–≤—è–∑–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º\n\n–¢–µ–ª: ${LEGAL_PHONE}\n–ü–æ—á—Ç–∞: ${LEGAL_MAIL}`,
    uz:`Menejer bilan bog'lanish\n\nTel: ${LEGAL_PHONE}\nPochta: ${LEGAL_MAIL}`,
    en:`Contact manager\n\nPhone: ${LEGAL_PHONE}\nEmail: ${LEGAL_MAIL}`
  };
  $('legalBody').textContent = body[lang] || body.ru;
  $('legalModal').classList.add('show');
}
function closeLegal(){ $('legalModal').classList.remove('show'); }
function legalBackdropClick(e){ if(e.target && e.target.id === 'legalModal') closeLegal(); }
function contactManager(){
  const link = `https://t.me/${ADMIN_TG_ID}`;
  try{ Telegram.WebApp.openLink(link); }catch(_){ window.open(link, "_blank"); }
}
function openTelLegal(){
  const tel = `tel:${LEGAL_PHONE.replace(/\s+/g,'')}`;
  try{ Telegram.WebApp.openLink(tel); }catch(_){ window.location.href = tel; }
}
function openMailLegal(){
  const mail = `mailto:${LEGAL_MAIL}`;
  try{ Telegram.WebApp.openLink(mail); }catch(_){ window.location.href = mail; }
}

/* theme */
let lang='ru', category='salads', type='delivery', payment='cash';
let cart = {};

function applyTheme(theme){
  document.body.setAttribute('data-theme', theme);
  localStorage.setItem('shashtovuq_theme', theme);
  const t = MENU_I18N[lang] || MENU_I18N.ru;
  $('themeMenuSub').innerText = (theme === 'dark') ? t.theme_dark : t.theme_light;
  try{
    Telegram.WebApp.setHeaderColor?.(theme === 'dark' ? '#121212' : '#fbf7ef');
    Telegram.WebApp.setBackgroundColor?.(theme === 'dark' ? '#121212' : '#fbf7ef');
  }catch(_){}
}
function toggleThemeFromMenu(){
  const cur = document.body.getAttribute('data-theme') || 'light';
  applyTheme(cur === 'dark' ? 'light' : 'dark');
}

let currentAboutLang = 'ru';
function openAbout(){
  closeTopMenu();
  setAboutLang(currentAboutLang);
  $('aboutModal').classList.add('show');
}
function closeAbout(){ $('aboutModal').classList.remove('show'); }
function aboutBackdropClick(e){ if(e.target && e.target.id === 'aboutModal') closeAbout(); }
function setAboutLang(l){
  currentAboutLang = l;
  $('aboutBody').textContent = ABOUT_TEXT[l] || ABOUT_TEXT.ru;
  $('tabRu').classList.toggle('active', l==='ru');
  $('tabUz').classList.toggle('active', l==='uz');
  $('tabEn').classList.toggle('active', l==='en');
}

/* main i18n */
function setLang(l,b){
  lang=l;
  document.querySelectorAll('.langs .btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  applyLang();
}
function applyBurgerI18n(){
  const t = MENU_I18N[lang] || MENU_I18N.ru;
  $('menuTitle').innerText = t.menu;
  $('mReviewTitle').innerText = t.review_title;
  $('mReviewSub').innerText = t.review_sub;
  $('mReviewHint').innerText = t.review_hint;
  $('mOpenReviewsBtn').innerText = t.open_reviews;
  $('mCallTitle').innerText = t.call;
  $('mInstaSub').innerText = t.insta_sub;
  $('mThemeTitle').innerText = t.theme;
  $('mThemeAction').innerText = t.theme_action;
  $('mAboutTitle').innerText = t.about;
  $('mAboutSub').innerText = t.about_sub;
  $('aboutTitle').innerText = t.about_title;
  $('mLegalTitle').innerText = t.legal_title;
  $('mLegalSub').innerText = t.legal_sub;
}
function syncThemeLabel(){
  const t = MENU_I18N[lang] || MENU_I18N.ru;
  const cur = document.body.getAttribute('data-theme') || 'light';
  $('themeMenuSub').innerText = (cur === 'dark') ? t.theme_dark : t.theme_light;
}

function getName(it){
  return (it && it.n && it.n[lang]) ? it.n[lang] : (it?.n?.ru || it?.id || '');
}

function renderPopular(){
  $('popularRow').innerHTML = '';
  POPULAR_IDS.forEach(id=>{
    const it = ITEM_BY_ID[id];
    if(!it) return;
    cart[id] = cart[id] || 0;
    const name = getName(it);
    $('popularRow').innerHTML += `
      <div class="pop-card" onclick="addPopular('${id}')">
        <div class="pop-badge">üî•</div>
        <div class="pop-img"><img src="${it.img}" onerror="this.src='logo.png'"></div>
        <div class="pop-name">${escapeHtml(name)}</div>
        <div class="pop-price">${formatSum(it.p)} <small>—Å—É–º</small></div>
      </div>
    `;
  });
}
function addPopular(id){
  chg(id, 1);
  if(isSearchOpen()) closeSearch();
}

function renderCats(){
  $('cats').innerHTML='';
  for(let k in MENU){
    $('cats').innerHTML+=`<button class="btn ${k===category?'active':''}" onclick="category='${k}';renderCats();renderProducts()">${CATS[lang][k] || k}</button>`;
  }
}
function cardHTML(it, q=''){
  const name = getName(it);
  const nameHtml = highlight(name, q);
  return `<div class="card">
    <div class="img"><img src="${it.img}" onerror="this.src='logo.png'"></div>
    <div>${nameHtml}</div>
    <div class="price">${formatSum(it.p)} <small>—Å—É–º</small></div>
    <div class="counter">
      <button onclick="chg('${it.id}',-1)">‚àí</button>
      <span id="c_${it.id}">${cart[it.id]||0}</span>
      <button onclick="chg('${it.id}',1)">+</button>
    </div>
  </div>`;
}
function renderProducts(){
  $('products').innerHTML='';
  (MENU[category] || []).forEach(it=>{
    cart[it.id]=cart[it.id]||0;
    $('products').innerHTML += cardHTML(it,'');
  });
}
function chg(id,v){
  cart[id]=Math.max(0,(cart[id]||0)+v);
  const el = document.getElementById('c_'+id);
  if(el) el.innerText=cart[id];
  updateTotal();
}
function price(id){ return ITEM_BY_ID[id]?.p || 0; }
function updateTotal(){
  let s=0;
  for(let id in cart) s += (cart[id]||0) * price(id);
  $('total').innerText = formatSum(s);
  $('stickyTotal').innerText = formatSum(s);
}

function applyTypeUI(){
  if(type === 'pickup'){
    $('address').style.display = 'none';
    $('address').value = '';
  } else {
    $('address').style.display = 'block';
  }
}
function setType(t,b){
  if(isSearchOpen()) closeSearch();
  type=t;
  document.querySelectorAll('.types .btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  applyTypeUI();
}
function setPayment(p){
  payment=p;
  $('payCash').classList.toggle('active',p==='cash');
  $('payClick').classList.toggle('active',p==='click');
}

function scrollToCart(){
  closeTopMenu();
  const el = $('cartBlock');
  if(!el) return;
  el.scrollIntoView({behavior:'smooth', block:'start'});
}

function isSearchOpen(){ return $('searchWrap').classList.contains('show'); }
function toggleSearch(){ isSearchOpen() ? closeSearch() : openSearch(); }
function openSearch(){
  $('searchWrap').classList.add('show');
  $('searchTitle').classList.add('show');
  $('cats').style.display = 'none';
  $('popularWrap').style.display = 'none';
  $('searchInput').value = '';
  $('searchInput').focus();
  searchProducts();
}
function closeSearch(){
  $('searchWrap').classList.remove('show');
  $('searchTitle').classList.remove('show');
  $('cats').style.display = '';
  $('popularWrap').style.display = '';
  $('searchInput').value = '';
  renderProducts();
}
function clearSearch(){ closeSearch(); }
function onSearchKey(e){ if(e.key === 'Enter') closeSearch(); }

function searchProducts(){
  const q = ($('searchInput').value || '').trim().toLowerCase();
  $('products').innerHTML='';
  if(!q){ renderProducts(); return; }

  for(let c in MENU){
    MENU[c].forEach(it=>{
      const name = getName(it);
      const n_ru = (it.n?.ru||'').toLowerCase();
      const n_uz = (it.n?.uz||'').toLowerCase();
      const n_en = (it.n?.en||'').toLowerCase();
      const n_cur = String(name).toLowerCase();

      if(n_cur.includes(q) || n_ru.includes(q) || n_uz.includes(q) || n_en.includes(q)){
        cart[it.id]=cart[it.id]||0;
        $('products').innerHTML += cardHTML(it, q);
      }
    });
  }
}

function genOrderId(){
  const d = new Date();
  const dd = String(d.getDate()).padStart(2,'0');
  const mm = String(d.getMonth()+1).padStart(2,'0');
  const key = `shashtovuq_seq_${d.getFullYear()}${mm}${dd}`;
  let n = Number(localStorage.getItem(key) || 0) + 1;
  localStorage.setItem(key, String(n));
  return `ST-${dd}${mm}-${String(n).padStart(3,'0')}`;
}
function calcTotalNum(){
  let s = 0;
  for (const id in cart) s += (Number(cart[id] || 0) * price(id));
  return s;
}
function buildOrderLines(){
  const lines = [];
  for(const id in cart){
    const qty = Number(cart[id]||0);
    if(qty<=0) continue;
    const it = ITEM_BY_ID[id];
    if(!it) continue;
    lines.push({ id, name: getName(it), qty, price: it.p, sum: it.p * qty });
  }
  return lines;
}

function sendOrder(){
  const cleanOrder = {};
  for (const id in cart) {
    const q = Number(cart[id] || 0);
    if (q > 0) cleanOrder[id] = q;
  }
  if (Object.keys(cleanOrder).length === 0) {
    alert(TEXT[lang].empty);
    return;
  }

  const payload = {
    tg: { id: tg_id, username: tg_username, first_name: tg_first_name },
    lang,
    items: buildOrderLines(),
    order: cleanOrder,
    total: $('total').innerText,
    total_num: calcTotalNum(),
    payment,
    type,
    address: type === 'pickup' ? '' : $('address').value,
    phone: $('phone').value,
    comment: $('comment').value,
    order_id: genOrderId()
  };

  Telegram.WebApp.sendData(JSON.stringify(payload));
  Telegram.WebApp.close();
}

function applyLang(){
  $('btnDelivery').innerText = TEXT[lang].delivery;
  $('btnPickup').innerText   = TEXT[lang].pickup;
  $('address').placeholder   = TEXT[lang].address;
  $('phone').placeholder     = TEXT[lang].phone;
  $('cartTitle').innerText   = TEXT[lang].cart;
  $('orderBtn').innerText    = TEXT[lang].order;
  $('comment').placeholder   = TEXT[lang].comment;
  $('payCash').innerText     = TEXT[lang].cash;
  $('payClick').innerText    = TEXT[lang].click;
  $('searchTitle').innerText = TEXT[lang].results;
  $('popularTitle').innerText= TEXT[lang].popular;
  $('stickyCart').innerText  = TEXT[lang].cart_btn;

  renderPopular();
  renderCats();
  renderProducts();
  updateTotal();

  applyBurgerI18n();
  syncThemeLabel();
  applyTypeUI();
}

/* saved inputs */
function loadSaved(){
  const a = localStorage.getItem("shashtovuq_address") || '';
  const p = localStorage.getItem("shashtovuq_phone") || '';
  if(a && !$('address').value) $('address').value = a;
  if(p && !$('phone').value) $('phone').value = p;
}
function bindSave(){
  $('address').addEventListener('input', ()=>localStorage.setItem("shashtovuq_address", $('address').value));
  $('phone').addEventListener('input', ()=>localStorage.setItem("shashtovuq_phone", $('phone').value));
}

/* init theme */
(function initTheme(){
  const saved = localStorage.getItem('shashtovuq_theme');
  if(saved === 'dark' || saved === 'light') applyTheme(saved);
  else{
    const tgTheme = Telegram.WebApp.colorScheme || 'light';
    applyTheme(tgTheme === 'dark' ? 'dark' : 'light');
  }
})();

loadSaved();
bindSave();
applyLang();
setAboutLang('ru');
</script>
</body>
</html>
