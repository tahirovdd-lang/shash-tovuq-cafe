<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>SHASH TOVUQ</title>

<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Yeseva+One&family=Montserrat:wght@500;700;800&display=swap" rel="stylesheet" />

<style>
:root{
  --sand:#fbf7ef;
  --text:#1f1f1f;

  --red1:#ff1b2d;
  --red2:#b40f18;

  --yellow1:#ffe600;
  --yellow2:#ffc400;

  --card-bg: rgba(255,255,255,.86);
  --line: rgba(0,0,0,.08);
  --shadow: 0 14px 34px rgba(0,0,0,.10);
}
body[data-theme="dark"]{
  --sand:#121212;
  --text:#f1f1f1;

  --card-bg: rgba(28,28,28,.92);
  --line: rgba(255,255,255,.12);
  --shadow: 0 18px 44px rgba(0,0,0,.35);
}
*{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
html, body{ width:100%; height:100%; margin:0; padding:0; }
html{ -webkit-text-size-adjust:100%; text-size-adjust:100%; }

body{
  font-family:'Montserrat',sans-serif;
  background:
    radial-gradient(1200px 600px at 50% -120px, rgba(180,15,24,.10), transparent 60%),
    linear-gradient(180deg, #fff, var(--sand));
  color:var(--text);
  padding-bottom:130px;
}

/* ‚úÖ Telegram –≤–µ—Ä—Ö–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—Ç —à–∞–ø–∫—É */
#app{
  min-height:100vh;
  min-height:100svh;
  min-height:100dvh;
  padding-top: env(safe-area-inset-top);
}

/* ‚úÖ Header: –º–∏–Ω–∏–º–∞–ª—å–Ω–æ —É–º–µ–Ω—å—à–∏–ª–∏ (–Ω–µ —Ç—Ä–æ–≥–∞—è —Ç–µ–∫—Å—Ç/–∫–Ω–æ–ø–∫–∏/–ª–æ–≥–æ) */
.header{
  padding:18px 14px 34px;      /* –±—ã–ª–æ 22/40 */
  min-height:158px;            /* –±—ã–ª–æ 170 */
  color:#fff;
  position:relative;
  text-align:center;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;

  background:
    linear-gradient(180deg, rgba(255,27,45,.92), rgba(180,15,24,.92)),
    url("atlas.jpg") center/cover no-repeat;

  box-shadow: 0 16px 34px rgba(0,0,0,.18);
  border-bottom: 1px solid rgba(255,255,255,.16);

  /* ‚úÖ –¥–æ–ø. –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É –ø–æ–¥ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ Telegram */
  padding-top: calc(18px + env(safe-area-inset-top));
}
.header::after{
  content:"";
  position:absolute;
  inset:0;
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  pointer-events:none;
}
.header::before{
  content:"";
  position:absolute;
  left:0; right:0; bottom:0;
  height:16px;
  background: linear-gradient(90deg, rgba(255,27,45,0), rgba(255,27,45,.90), rgba(255,27,45,0));
  opacity:.95;
  pointer-events:none;
}
.header img{
  position:absolute;
  left:10px;
  top:50%;
  transform:translateY(-50%);
  width:88px;
  max-width:30vw;
  height:auto;
  z-index:5;

  padding:8px;
  border-radius:18px;
  background: rgba(255,255,255,.16);
  border: 1px solid rgba(255,255,255,.28);
  box-shadow: 0 14px 30px rgba(0,0,0,.20);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

.brand-top{
  font-size:13px;
  letter-spacing:2.6px;
  font-weight:900;
  text-transform:uppercase;
  opacity:.96;
  margin-bottom:7px;
  text-shadow: 0 10px 18px rgba(0,0,0,.25);
}
.brand-title{
  font-family:'Yeseva One', serif;
  font-size:24px;
  letter-spacing:1px;
  text-transform:uppercase;
  text-shadow: 0 12px 22px rgba(0,0,0,.28);
  position:relative;
  z-index:6;
  line-height:1.0;
  transform: translateX(28px);
}
.brand-phone{
  position:relative;
  z-index:50;
  pointer-events:none;
  margin-top:9px;
  font-size:15px;
  font-weight:900;
  opacity:.95;
  transform: translateX(28px);
  text-align:left;
}
.brand-tel{
  position:relative;
  z-index:50;
  pointer-events:none;
  margin-top:6px;
  font-size:14px;
  font-weight:900;
  opacity:.95;
  transform: translateX(28px);
  text-align:left;
}

/* –∫–Ω–æ–ø–∫–∏ —Å–ø—Ä–∞–≤–∞ —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑ */
.header-actions{
  position:absolute;
  right:10px;
  top: calc(10px + env(safe-area-inset-top)); /* ‚úÖ –Ω–µ –ø–æ–¥ —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏ */
  z-index:90;
  display:flex;
  flex-direction:column;
  gap:8px;
  align-items:center;
}
.hbtn{
  width:34px;
  height:34px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:16px;
  font-weight:900;
  cursor:pointer;
  color:#fff;
  background: rgba(255,255,255,.16);
  border:1px solid rgba(255,255,255,.26);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  box-shadow: 0 14px 30px rgba(0,0,0,.18);
  transition:.15s;
}
.hbtn:active{ transform:scale(.97); }

.burger-ic{ width:18px; height:12px; position:relative; }
.burger-ic span{
  position:absolute; left:0; right:0;
  height:2px; border-radius:8px;
  background:#fff; opacity:.95;
}
.burger-ic span:nth-child(1){ top:0; }
.burger-ic span:nth-child(2){ top:5px; }
.burger-ic span:nth-child(3){ bottom:0; }

/* –∫–Ω–æ–ø–∫–∏ */
.langs,.types,.payments{
  display:flex;
  gap:10px;
  padding:12px 12px 6px;
  justify-content:center;
}
.btn{
  padding:12px 16px;
  border-radius:18px;
  font-weight:900;
  min-width:118px;
  text-align:center;
  cursor:pointer;
  transition:.15s;
  border:1px solid rgba(0,0,0,.10);
  background:#fff;
  box-shadow: 0 10px 24px rgba(0,0,0,.06);
  color:var(--text);
}
.btn:active{ transform:scale(.98); }

/* ‚úÖ —è–∑—ã–∫ –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É */
.langs{
  flex-wrap:nowrap;
  gap:8px;
}
.langs .btn{
  min-width:0;
  flex:1 1 0;
  padding:10px 10px;
}
.langs .btn.active{
  background: linear-gradient(135deg, var(--yellow1), var(--yellow2));
  color:#111;
  border:1px solid rgba(0,0,0,.12);
  box-shadow: 0 14px 30px rgba(255,196,0,.25);
}

/* –¥–æ—Å—Ç–∞–≤–∫–∞/—Å–∞–º–æ–≤—ã–≤–æ–∑ –∞–∫—Ç–∏–≤–Ω—ã–π –∫—Ä–∞—Å–Ω—ã–π */
.types{
  flex-wrap:wrap;
}
.types .btn.active{
  background: linear-gradient(135deg, var(--red1), var(--red2));
  color:#fff;
  border:1px solid rgba(255,255,255,.22);
  box-shadow: 0 14px 30px rgba(255,27,45,.22);
}

/* –æ–ø–ª–∞—Ç–∞ –∞–∫—Ç–∏–≤–Ω—ã–π –∫—Ä–∞—Å–Ω—ã–π */
.payments{
  flex-wrap:wrap;
}
.payments .btn.active{
  background: linear-gradient(135deg, var(--red1), var(--red2));
  color:#fff;
  border:1px solid rgba(255,255,255,.22);
  box-shadow: 0 14px 30px rgba(255,27,45,.22);
}

.input{
  margin:8px auto;
  display:block;
  padding:14px 14px;
  width:min(520px, 92%);
  border-radius:18px;
  font-size:15px;
  border:1px solid var(--line);
  background: rgba(255,255,255,.92);
  box-shadow: 0 10px 24px rgba(0,0,0,.06);
  outline:none;
  transition:.15s;
  color:var(--text);
}
body[data-theme="dark"] .input{ background: rgba(28,28,28,.92); }
.input:focus{
  border-color: rgba(255,27,45,.35);
  box-shadow: 0 14px 30px rgba(255,27,45,.12);
}

/* –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ */
.categories{
  display:flex;
  gap:8px;
  padding:10px 12px 4px;
  overflow-x:auto;
  scroll-behavior:smooth;
  -webkit-overflow-scrolling:touch;
}
.categories .btn{
  min-width:122px;
  padding:9px 12px;
  border-radius:16px;
  font-size:13px;
}
.categories .btn.active{
  background: linear-gradient(135deg, var(--yellow1), var(--yellow2));
  color:#111;
  border:1px solid rgba(0,0,0,.12);
  box-shadow: 0 14px 30px rgba(255,196,0,.25);
}

/* products */
.products{
  display:grid;
  grid-template-columns:repeat(2,minmax(0,1fr));
  gap:14px;
  padding:12px;
  max-width:760px;
  margin:0 auto;
}
.card{
  border-radius:24px;
  padding:12px 10px;
  text-align:center;
  background: var(--card-bg);
  border:1px solid rgba(0,0,0,.06);
  box-shadow: var(--shadow);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  transition:.15s;
  position:relative;
}
body[data-theme="dark"] .card{ border-color: rgba(255,255,255,.10); }
.card:active{ transform:scale(.99); }

.img{ height:104px; display:flex; align-items:center; justify-content:center; }
.img img{ max-width:92px; opacity:.95; cursor:pointer; }

.price{ font-weight:900; color:var(--red2); margin-top:6px; }
.price small{ font-weight:800; opacity:.75; margin-left:4px; }

/* üå∂Ô∏è –æ—Å—Ç—Ä–æ–µ */
.spicy-badge{
  position:absolute;
  left:10px;
  top:10px;
  font-size:18px;
  pointer-events:none;
  filter: drop-shadow(0 8px 14px rgba(0,0,0,.20));
}

/* —Ä–∞–∑–º–µ—Ä */
.size-row{
  display:flex;
  gap:8px;
  justify-content:center;
  margin-top:10px;
  flex-wrap:wrap;
}
.size-chip{
  padding:7px 10px;
  border-radius:999px;
  border:1px solid rgba(0,0,0,.12);
  background: rgba(255,255,255,.85);
  font-weight:900;
  font-size:12px;
  cursor:pointer;
  box-shadow: 0 10px 18px rgba(0,0,0,.06);
}
body[data-theme="dark"] .size-chip{
  background: rgba(28,28,28,.92);
  border-color: rgba(255,255,255,.12);
}
.size-chip.active{
  background: linear-gradient(135deg, var(--yellow1), var(--yellow2));
  border:1px solid rgba(0,0,0,.14);
}

/* +/- */
.counter{ display:flex; justify-content:center; gap:10px; margin-top:10px; align-items:center; }
.counter button{
  width:34px;
  height:34px;
  border-radius:50%;
  cursor:pointer;
  border:1px solid rgba(0,0,0,.12);
  background: linear-gradient(135deg, var(--yellow1), var(--yellow2));
  color:#111;
  font-size:16px;
  box-shadow: 0 12px 22px rgba(255,196,0,.25);
  transition:.15s;
}
.counter button:active{ transform:scale(.96); }

/* cart */
.cart{
  background: rgba(255,255,255,.88);
  margin:12px auto;
  padding:16px;
  border-radius:26px;
  border:1px solid rgba(255,27,45,.18);
  box-shadow: var(--shadow);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  max-width:760px;
}
body[data-theme="dark"] .cart{ background: rgba(28,28,28,.92); border-color: rgba(255,27,45,.22); }
#cartTitle{ color: var(--red2); }
textarea.input{ height:90px; }

.order-btn{
  width:100%;
  padding:18px;
  margin-top:14px;
  margin-bottom:110px;
  border-radius:24px;
  cursor:pointer;
  color:white;
  font-size:17px;
  font-weight:900;
  border:1px solid rgba(255,255,255,.18);
  background: linear-gradient(135deg, var(--red1), var(--red2));
  box-shadow: 0 18px 36px rgba(255,27,45,.22);
  transition:.15s;
}
.order-btn:active{ transform:scale(.99); }

/* search */
.search-wrap{
  width:min(520px, 92%);
  margin:8px auto;
  position:relative;
  display:none;
  z-index:70;
}
.search-wrap.show{ display:block; }
.search-wrap input{ width:100%; margin:0; padding-right:44px; }

.search-clear{
  position:absolute;
  right:10px;
  top:50%;
  transform:translateY(-50%);
  width:32px;
  height:32px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  border:1px solid rgba(0,0,0,.08);
  background: rgba(255,255,255,.92);
  box-shadow: 0 10px 22px rgba(0,0,0,.08);
  transition:.15s;
  color:#111;
}
body[data-theme="dark"] .search-clear{ background: rgba(28,28,28,.92); border-color: rgba(255,255,255,.10); color:#f1f1f1; }
.search-clear:active{ transform:translateY(-50%) scale(.96); }

.search-title{
  width:min(520px, 92%);
  margin:10px auto 0;
  font-weight:900;
  opacity:.92;
  display:none;
  z-index:70;
  position:relative;
}
.search-title.show{ display:block; }

mark{ background:rgba(255,230,0,.40); padding:0 .14em; border-radius:8px; }

/* carousels */
.section{
  width:100%;
  padding:4px 12px 4px;
  max-width:760px;
  margin:0 auto;
}
.section-title{
  width:100%;
  font-weight:900;
  padding:8px 2px 10px;
  display:flex;
  align-items:center;
  gap:8px;
  color: var(--red2);
}
.row{
  display:flex;
  gap:12px;
  overflow-x:auto;
  padding:2px 2px 10px;
  -webkit-overflow-scrolling:touch;
}
.combo-card{
  min-width:230px;
  border-radius:26px;
  padding:14px;
  background: var(--card-bg);
  border:1px solid rgba(0,0,0,.06);
  box-shadow: var(--shadow);
  cursor:pointer;
  transition:.15s;
  position:relative;
  overflow:hidden;
}
.combo-card:active{ transform:scale(.99); }
.combo-img{
  height:130px;
  border-radius:18px;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
  background: rgba(255,27,45,.10);
}
.combo-img img{ width:100%; height:100%; object-fit:cover; cursor:pointer; }
.combo-name{ font-weight:900; margin-top:10px; }
.combo-price{ font-weight:900; color:var(--red2); margin-top:6px; }
.badge{ position:absolute; left:10px; top:10px; font-size:18px; pointer-events:none; }

.small-card{
  min-width:190px;
  border-radius:24px;
  padding:12px;
  background: var(--card-bg);
  border:1px solid rgba(0,0,0,.06);
  box-shadow: var(--shadow);
  transition:.15s;
  position:relative;
  overflow:hidden;
  cursor:pointer;
}
.small-card:active{ transform:scale(.99); }
.small-img{
  height:110px;
  border-radius:18px;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
  background: rgba(255,27,45,.10);
}
.small-img img{ width:100%; height:100%; object-fit:cover; cursor:pointer; }
.small-name{ font-weight:900; margin-top:10px; }
.small-price{ font-weight:900; color:var(--red2); margin-top:6px; }

.mini-counter{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-top:10px;
}
.mini-counter button{
  width:34px;height:34px;
  border-radius:50%;
  border:1px solid rgba(0,0,0,.12);
  background: linear-gradient(135deg, var(--yellow1), var(--yellow2));
  color:#111;
  font-weight:900;
  cursor:pointer;
  box-shadow: 0 12px 22px rgba(255,196,0,.25);
}
.mini-counter button:active{ transform:scale(.96); }
.mini-count{
  font-weight:900;
  min-width:22px;
  text-align:center;
}

/* sticky */
.sticky-checkout{
  position:fixed;
  left:0; right:0; bottom:0;
  padding:10px 12px env(safe-area-inset-bottom);
  background: rgba(251,247,239,.72);
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
  z-index:999;
  border-top:1px solid rgba(255,27,45,.14);
}
body[data-theme="dark"] .sticky-checkout{ background: rgba(18,18,18,.72); border-top-color: rgba(255,27,45,.22); }
.sticky-inner{
  max-width:760px;
  margin:0 auto;
  border-radius:20px;
  padding:10px 12px;
  background: rgba(255,255,255,.88);
  border:1px solid rgba(255,27,45,.16);
  box-shadow: 0 16px 34px rgba(0,0,0,.10);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}
body[data-theme="dark"] .sticky-inner{ background: rgba(28,28,28,.88); border-color: rgba(255,27,45,.22); }
.sticky-sum{ font-weight:900; line-height:1.1; color: var(--red2); }
.sticky-sum small{ display:block; font-weight:800; opacity:.70; margin-top:2px; }
.sticky-btn{
  padding:12px 14px;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.18);
  background: linear-gradient(135deg, var(--red1), var(--red2));
  color:#fff;
  font-weight:900;
  cursor:pointer;
  box-shadow: 0 16px 34px rgba(255,27,45,.20);
  transition:.15s;
  white-space:nowrap;
}
.sticky-btn:active{ transform:scale(.99); }

/* bottom sheets */
.backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.40);
  opacity:0;
  pointer-events:none;
  transition:.18s;
}
.backdrop.show{ opacity:1; pointer-events:auto; }

.sheet{
  position:fixed;
  left:0; right:0;
  bottom:-120%;
  transition:.22s;
  padding:10px 12px 14px;
  background: rgba(255,255,255,.95);
  border-top-left-radius:24px;
  border-top-right-radius:24px;
  border:1px solid rgba(0,0,0,.08);
  box-shadow: 0 18px 48px rgba(0,0,0,.22);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
}
body[data-theme="dark"] .sheet{
  background: rgba(28,28,28,.95);
  border-color: rgba(255,255,255,.10);
}
.sheet.show{ bottom:0; }

.handle{
  width:44px;
  height:5px;
  border-radius:999px;
  background:rgba(0,0,0,.18);
  margin:6px auto 10px;
}
body[data-theme="dark"] .handle{ background:rgba(255,255,255,.18); }

.sheet-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:2px 4px 10px;
}
.sheet-head b{ font-size:16px; color: var(--red2); }
.sheet-close{
  width:38px;height:38px;
  border:none;
  border-radius:12px;
  background:transparent;
  cursor:pointer;
  font-size:22px;
  line-height:1;
  color:#777;
}
body[data-theme="dark"] .sheet-close{ color:#bbb; }

/* burger list */
.menu-list{ display:flex; flex-direction:column; gap:8px; }
.menu-item{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:12px;
  border-radius:18px;
  border:1px solid rgba(0,0,0,.08);
  background: rgba(0,0,0,.03);
  cursor:pointer;
  text-decoration:none;
  color:var(--text);
}
body[data-theme="dark"] .menu-item{
  border-color: rgba(255,255,255,.10);
  background: rgba(255,255,255,.06);
}
.menu-left{ display:flex; align-items:center; gap:10px; min-width:0; }
.menu-ic{
  width:32px; height:32px;
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  background: rgba(255,27,45,.10);
  flex:0 0 auto;
}
body[data-theme="dark"] .menu-ic{ background: rgba(255,27,45,.16); }
.menu-txt{ display:flex; flex-direction:column; min-width:0; }
.menu-name{ font-weight:900; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.menu-sub{ font-size:12px; opacity:.75; margin-top:2px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.menu-right{ opacity:.65; font-weight:900; }

/* subcats: icon tiles */
.subcat-grid{
  display:grid;
  grid-template-columns:repeat(3, minmax(0,1fr));
  gap:12px;
  padding:6px 2px 2px;
}
.subcat-item{
  border:1px solid rgba(0,0,0,.10);
  background:#fff;
  border-radius:20px;
  padding:10px 8px;
  cursor:pointer;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:8px;
  min-height:96px;
  box-shadow: 0 10px 22px rgba(0,0,0,.06);
  transition:.15s;
}
.subcat-item:active{ transform:scale(.98); }
.subcat-item.active{
  background: linear-gradient(135deg, var(--yellow1), var(--yellow2));
  border:1px solid rgba(0,0,0,.14);
  box-shadow: 0 14px 30px rgba(255,196,0,.25);
}
.subcat-ic{
  width:52px;
  height:52px;
  border-radius:18px;
  background: rgba(0,0,0,.06);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
}
.subcat-item.active .subcat-ic{
  background: rgba(255,255,255,.55);
}
.subcat-name{
  font-weight:900;
  font-size:12.6px;
  text-align:center;
  line-height:1.15;
}

/* ‚úÖ image modal */
.img-modal-backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.65);
  opacity:0;
  pointer-events:none;
  transition:.18s;
  z-index:5000;
}
.img-modal-backdrop.show{ opacity:1; pointer-events:auto; }
.img-modal{
  position:fixed;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%) scale(.98);
  width:min(92vw, 520px);
  max-height:80vh;
  background:rgba(255,255,255,.92);
  border-radius:22px;
  border:1px solid rgba(255,255,255,.25);
  box-shadow: 0 22px 70px rgba(0,0,0,.35);
  overflow:hidden;
  opacity:0;
  pointer-events:none;
  transition:.18s;
  z-index:5010;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}
body[data-theme="dark"] .img-modal{ background: rgba(18,18,18,.92); border-color: rgba(255,255,255,.12); }
.img-modal.show{
  opacity:1;
  pointer-events:auto;
  transform:translate(-50%,-50%) scale(1);
}
.img-modal img{
  width:100%;
  height:auto;
  max-height:80vh;
  object-fit:contain;
  display:block;
  background:rgba(0,0,0,.04);
}
.img-modal-close{
  position:absolute;
  right:10px;
  top:10px;
  width:38px;
  height:38px;
  border-radius:12px;
  border:none;
  cursor:pointer;
  font-size:22px;
  line-height:1;
  color:#fff;
  background: rgba(0,0,0,.35);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
}
.img-modal-close:active{ transform:scale(.98); }

@media (max-width:380px){
  .header{ min-height:150px; padding:16px 12px 32px; padding-top: calc(16px + env(safe-area-inset-top)); }
  .brand-title{ font-size:24px; transform: translateX(22px); }
  .brand-phone{ transform: translateX(22px); }
  .brand-tel{ transform: translateX(22px); }
  .header img{ width:74px; padding:7px; border-radius:16px; }
  .hbtn{ width:32px; height:32px; font-size:15px; }
  .products{ gap:12px; padding:12px; }
  .img{ height:96px; }
  .img img{ max-width:86px; }
  .categories .btn{ min-width:116px; font-size:12.6px; padding:8px 10px; }
  .combo-card{ min-width:210px; }
  .small-card{ min-width:178px; }
  .subcat-grid{ grid-template-columns:repeat(3, minmax(0,1fr)); gap:10px; }
  .subcat-item{ min-height:92px; border-radius:18px; }
  .subcat-ic{ width:48px; height:48px; border-radius:16px; }
  .langs .btn{ padding:10px 8px; font-size:13px; }
}
@media (max-width:330px){
  .subcat-grid{ grid-template-columns:repeat(2, minmax(0,1fr)); }
}
</style>
</head>

<body data-theme="light">
<div id="app">

  <div class="header">
    <img src="logo.png" onerror="this.src='logo.png'">

    <div style="position:relative; z-index:6;">
      <div class="brand-top">Fast Food</div>
      <div class="brand-title">SHASH TOVUQ</div>
      <div class="brand-phone">Tatib ko'ring mazali !</div>
      <div class="brand-tel">+998 95 410 37 38</div>
    </div>

    <div class="header-actions" aria-label="Header actions">
      <div class="hbtn" onclick="openTopMenu()" title="–ú–µ–Ω—é" aria-label="–ú–µ–Ω—é">
        <div class="burger-ic"><span></span><span></span><span></span></div>
      </div>
      <div class="hbtn" onclick="openMap()" title="–ú–∞—Ä—à—Ä—É—Ç" aria-label="–õ–æ–∫–∞—Ü–∏—è">üìç</div>
      <div class="hbtn" onclick="toggleSearch()" title="–ü–æ–∏—Å–∫" aria-label="–ü–æ–∏—Å–∫">üîç</div>
    </div>
  </div>

  <div class="search-title" id="searchTitle">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</div>
  <div class="search-wrap" id="searchWrap">
    <input id="searchInput" class="input" placeholder="–ü–æ–∏—Å–∫ –±–ª—é–¥–∞..." oninput="searchProducts()" onkeydown="onSearchKey(event)">
    <div class="search-clear" onclick="clearSearch()" title="–û—á–∏—Å—Ç–∏—Ç—å">‚úñ</div>
  </div>

  <div class="langs">
    <button class="btn active" onclick="setLang('ru',this)">üá∑üá∫ RU</button>
    <button class="btn" onclick="setLang('uz',this)">üá∫üáø UZ</button>
    <button class="btn" onclick="setLang('en',this)">üá¨üáß EN</button>
  </div>

  <div class="section" id="comboWrap">
    <div class="section-title" id="comboTitle">üç± –ö–æ–º–±–æ</div>
    <div class="row" id="comboRow"></div>
  </div>

  <div class="section" id="popularWrap">
    <div class="section-title" id="popularTitle">üî• –ü–æ–ø—É–ª—è—Ä–Ω–æ–µ</div>
    <div class="row" id="popularRow"></div>
  </div>

  <div class="section" id="newWrap">
    <div class="section-title" id="newTitle">‚ú® –ù–æ–≤–∏–Ω–∫–∏</div>
    <div class="row" id="newRow"></div>
  </div>

  <div class="types">
    <button class="btn active" id="btnDelivery" onclick="setType('delivery',this)"></button>
    <button class="btn" id="btnPickup" onclick="setType('pickup',this)"></button>
  </div>

  <input id="address" class="input">
  <input id="phone" class="input">

  <div class="categories" id="cats"></div>

  <div class="products" id="products"></div>

  <div class="cart" id="cartBlock">
    <b id="cartTitle"></b>: <span id="total">0</span> —Å—É–º
    <textarea id="comment" class="input"></textarea>
    <div class="payments">
      <button class="btn active" id="payCash" onclick="setPayment('cash')"></button>
      <button class="btn" id="payClick" onclick="setPayment('click')"></button>
    </div>
    <button class="order-btn" id="orderBtn" onclick="sendOrder()"></button>
  </div>

  <div class="sticky-checkout">
    <div class="sticky-inner">
      <div class="sticky-sum">
        <span id="stickyTotal">0</span> <small>—Å—É–º</small>
      </div>
      <button class="sticky-btn" onclick="scrollToCart()" id="stickyCart">üõí –ö–æ—Ä–∑–∏–Ω–∞</button>
    </div>
  </div>

  <!-- Burger sheet -->
  <div class="backdrop" id="menuBackdrop" onclick="closeTopMenu()" style="z-index:2000;"></div>
  <div class="sheet" id="menuSheet" role="dialog" aria-modal="true" style="z-index:2010;">
    <div class="handle"></div>
    <div class="sheet-head">
      <b id="menuTitle">–ú–µ–Ω—é</b>
      <button class="sheet-close" onclick="closeTopMenu()">√ó</button>
    </div>

    <div class="menu-list">
      <div class="menu-item" onclick="toggleReviewWidget()" role="button">
        <div class="menu-left">
          <div class="menu-ic">‚≠ê</div>
          <div class="menu-txt">
            <div class="menu-name" id="mReviewTitle">–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</div>
            <div class="menu-sub" id="mReviewSub">–Ø–Ω–¥–µ–∫—Å —Ä–µ–π—Ç–∏–Ω–≥ / –æ—Ç–∑—ã–≤—ã</div>
          </div>
        </div>
        <div class="menu-right">‚Ä∫</div>
      </div>

      <div id="reviewWidgetWrap" style="display:none; padding:6px 4px 10px;">
        <div style="border:1px solid rgba(0,0,0,.08); border-radius:18px; overflow:hidden; background:#fff; padding:10px; display:flex; justify-content:center;">
          <iframe src="https://yandex.ru/sprav/widget/rating-badge/23178318202?type=rating" width="150" height="50" frameborder="0" style="border:0; display:block;"></iframe>
        </div>
        <div class="menu-sub" id="mReviewHint" style="margin-top:8px;">
          –ï—Å–ª–∏ –≤–∏–¥–∂–µ—Ç –Ω–µ –æ—Ç–∫—Ä—ã–ª—Å—è –≤ Telegram ‚Äî –Ω–∞–∂–º–∏ ¬´–û—Ç–∫—Ä—ã—Ç—å –æ—Ç–∑—ã–≤—ã¬ª.
        </div>
        <div style="display:flex; justify-content:center; margin-top:8px;">
          <button class="btn" style="min-width:auto; padding:10px 14px; border-radius:999px;" id="mOpenReviewsBtn" onclick="openYandexReviews(event)">–û—Ç–∫—Ä—ã—Ç—å –æ—Ç–∑—ã–≤—ã</button>
        </div>
      </div>

      <div class="menu-item" onclick="openLegal()" role="button">
        <div class="menu-left">
          <div class="menu-ic">üè¢</div>
          <div class="menu-txt">
            <div class="menu-name" id="mLegalTitle">–î–ª—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü</div>
            <div class="menu-sub" id="mLegalSub">–°–≤—è–∑–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º</div>
          </div>
        </div>
        <div class="menu-right">‚Ä∫</div>
      </div>

      <a class="menu-item" href="tel:+998954103738" onclick="closeTopMenu()">
        <div class="menu-left">
          <div class="menu-ic">üìû</div>
          <div class="menu-txt">
            <div class="menu-name" id="mCallTitle">–ü–æ–∑–≤–æ–Ω–∏—Ç—å</div>
            <div class="menu-sub">+998 95 410 37 38</div>
          </div>
        </div>
        <div class="menu-right">‚Ä∫</div>
      </a>

      <a class="menu-item" href="#" onclick="openInstagram(event)">
        <div class="menu-left">
          <div class="menu-ic">üì∑</div>
          <div class="menu-txt">
            <div class="menu-name" id="mInstaTitle">@shash.tovuq.n1</div>
            <div class="menu-sub" id="mInstaSub">–û—Ç–∫—Ä—ã—Ç—å Instagram</div>
          </div>
        </div>
        <div class="menu-right">‚Ä∫</div>
      </a>

      <div class="menu-item" onclick="toggleThemeFromMenu()" role="button">
        <div class="menu-left">
          <div class="menu-ic">üåì</div>
          <div class="menu-txt">
            <div class="menu-name" id="mThemeTitle">–¢–µ–º–∞</div>
            <div class="menu-sub" id="themeMenuSub">–°–≤–µ—Ç–ª–∞—è</div>
          </div>
        </div>
        <div class="menu-right" id="mThemeAction">–°–º–µ–Ω–∏—Ç—å</div>
      </div>

      <div class="menu-item" onclick="openAbout()" role="button">
        <div class="menu-left">
          <div class="menu-ic">‚ÑπÔ∏è</div>
          <div class="menu-txt">
            <div class="menu-name" id="mAboutTitle">–û –Ω–∞—Å</div>
            <div class="menu-sub" id="mAboutSub">–ê–¥—Ä–µ—Å –∏ –æ–ø–∏—Å–∞–Ω–∏–µ</div>
          </div>
        </div>
        <div class="menu-right">‚Ä∫</div>
      </div>
    </div>
  </div>

  <!-- Subcategories bottom sheet (–∏–∫–æ–Ω–∫–∏) -->
  <div class="backdrop" id="subcatBackdrop" onclick="closeSubcats()" style="z-index:2050;"></div>
  <div class="sheet" id="subcatSheet" role="dialog" aria-modal="true" style="z-index:2060;">
    <div class="handle"></div>
    <div class="sheet-head">
      <b id="subcatTitle">–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏</b>
      <button class="sheet-close" onclick="closeSubcats()">√ó</button>
    </div>
    <div class="subcat-grid" id="subcatGrid"></div>
  </div>

  <!-- About / Legal sheets -->
  <div class="backdrop" id="aboutBackdrop" onclick="closeAbout()" style="z-index:2100; display:none; opacity:1;"></div>
  <div class="sheet" id="aboutSheet" style="z-index:2110; display:none;">
    <div class="handle"></div>
    <div class="sheet-head">
      <b id="aboutTitle">–û –Ω–∞—Å</b>
      <button class="sheet-close" onclick="closeAbout()">√ó</button>
    </div>
    <div style="display:flex; gap:10px; overflow-x:auto; padding:6px 2px 10px; -webkit-overflow-scrolling:touch;">
      <button class="btn" id="tabRu" onclick="setAboutLang('ru')" style="min-width:auto;">üá∑üá∫ RU</button>
      <button class="btn" id="tabUz" onclick="setAboutLang('uz')" style="min-width:auto;">üá∫üáø UZ</button>
      <button class="btn" id="tabEn" onclick="setAboutLang('en')" style="min-width:auto;">üá¨üáß EN</button>
    </div>
    <div id="aboutBody" style="white-space:pre-wrap; line-height:1.45; padding:2px 4px 6px;"></div>
  </div>

  <div class="backdrop" id="legalBackdrop" onclick="closeLegal()" style="z-index:2200; display:none; opacity:1;"></div>
  <div class="sheet" id="legalSheet" style="z-index:2210; display:none;">
    <div class="handle"></div>
    <div class="sheet-head">
      <b id="legalTitle">–î–ª—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü</b>
      <button class="sheet-close" onclick="closeLegal()">√ó</button>
    </div>
    <div id="legalBody" style="white-space:pre-wrap; line-height:1.45; padding:2px 4px 6px;"></div>
    <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;">
      <button class="btn" onclick="contactManager()" style="flex:1 1 auto; min-width:auto;">–°–≤—è–∑–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º</button>
      <button class="btn" onclick="openTelLegal()" style="flex:1 1 auto; min-width:auto;">–ü–æ–∑–≤–æ–Ω–∏—Ç—å</button>
      <button class="btn" onclick="openMailLegal()" style="flex:1 1 auto; min-width:auto;">–ü–æ—á—Ç–∞</button>
    </div>
  </div>

  <!-- ‚úÖ Image modal -->
  <div class="img-modal-backdrop" id="imgModalBackdrop" onclick="closeImgModal()"></div>
  <div class="img-modal" id="imgModal" role="dialog" aria-modal="true">
    <button class="img-modal-close" onclick="closeImgModal()">√ó</button>
    <img id="imgModalImg" src="" alt="preview" />
  </div>

</div><!-- /#app -->

<script>
/* ‚úÖ —Ñ–∏–∫—Å ‚Äú50% –≤—ã—Å–æ—Ç—ã‚Äù –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –≤ Telegram */
Telegram.WebApp.ready();
Telegram.WebApp.expand();
try{ Telegram.WebApp.requestFullscreen?.(); }catch(_){}
try{ Telegram.WebApp.disableVerticalSwipes?.(); }catch(_){}

const $ = (id)=>document.getElementById(id);

const IG_URL = "https://www.instagram.com/shash.tovuq.n1/";
const YANDEX_WIDGET_URL = "https://yandex.ru/sprav/widget/rating-badge/23178318202?type=rating";
const MAP_URL = "https://yandex.uz/maps/org/23178318202/?ll=66.950144%2C39.645189&z=16.65";

const LEGAL_PHONE = "+998 91 319 70 07";
const LEGAL_MAIL  = "shashtovuq@gmail.com";
const ADMIN_TG_ID = "6013591658";

function openMap(){
  try{ Telegram.WebApp.openLink(MAP_URL); }
  catch(_){ window.open(MAP_URL, "_blank"); }
}

/* ‚úÖ image modal */
function openImgModal(src){
  $('imgModalImg').src = src || 'logo.png';
  $('imgModalBackdrop').classList.add('show');
  $('imgModal').classList.add('show');
}
function closeImgModal(){
  $('imgModalBackdrop').classList.remove('show');
  $('imgModal').classList.remove('show');
  setTimeout(()=>{ $('imgModalImg').src=''; }, 120);
}

/* i18n */
const MENU_I18N = {
  ru:{menu:'–ú–µ–Ω—é',review_title:'–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤',review_sub:'–Ø–Ω–¥–µ–∫—Å —Ä–µ–π—Ç–∏–Ω–≥ / –æ—Ç–∑—ã–≤—ã',review_hint:'–ï—Å–ª–∏ –≤–∏–¥–∂–µ—Ç –Ω–µ –æ—Ç–∫—Ä—ã–ª—Å—è –≤ Telegram ‚Äî –Ω–∞–∂–º–∏ ¬´–û—Ç–∫—Ä—ã—Ç—å –æ—Ç–∑—ã–≤—ã¬ª.',open_reviews:'–û—Ç–∫—Ä—ã—Ç—å –æ—Ç–∑—ã–≤—ã',call:'–ü–æ–∑–≤–æ–Ω–∏—Ç—å',insta_sub:'–û—Ç–∫—Ä—ã—Ç—å Instagram',theme:'–¢–µ–º–∞',theme_light:'–°–≤–µ—Ç–ª–∞—è',theme_dark:'–¢—ë–º–Ω–∞—è',theme_action:'–°–º–µ–Ω–∏—Ç—å',about:'–û –Ω–∞—Å',about_sub:'–ê–¥—Ä–µ—Å –∏ –æ–ø–∏—Å–∞–Ω–∏–µ',about_title:'–û –Ω–∞—Å',legal_title:'–î–ª—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü',legal_sub:'–°–≤—è–∑–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º',subcats:'–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏',combo:'üç± –ö–æ–º–±–æ',new:'‚ú® –ù–æ–≤–∏–Ω–∫–∏'},
  uz:{menu:'Menyu',review_title:'Fikr qoldirish',review_sub:'Yandex reyting / fikrlar',review_hint:'Agar vidjet Telegramda ochilmasa ‚Äî ¬´Sharhlarni ochish¬ªni bosing.',open_reviews:"Sharhlarni ochish",call:"Qo'ng'iroq qilish",insta_sub:"Instagramni ochish",theme:"Mavzu",theme_light:"Yorug'",theme_dark:"Qorong'i",theme_action:"Almashtirish",about:"Biz haqimizda",about_sub:"Manzil va ma'lumot",about_title:"Biz haqimizda",legal_title:"Yuridik shaxslar uchun",legal_sub:"Menejer bilan bog'lanish",subcats:"Ichki bo'limlar",combo:"üç± Kombo",new:"‚ú® Yangi"},
  en:{menu:'Menu',review_title:'Leave a review',review_sub:'Yandex rating / reviews',review_hint:'If the widget doesn‚Äôt open in Telegram ‚Äî tap ‚ÄúOpen reviews‚Äù.',open_reviews:'Open reviews',call:'Call',insta_sub:'Open Instagram',theme:'Theme',theme_light:'Light',theme_dark:'Dark',theme_action:'Switch',about:'About us',about_sub:'Address and info',about_title:'About us',legal_title:'For legal entities',legal_sub:'Contact manager',subcats:'Subcategories',combo:'üç± Combo',new:'‚ú® New'}
};

const ABOUT_TEXT = {
  ru:`üá∑üá∫ –û –Ω–∞—Å

Fast Food SHASH TOVUQ ‚Äî –±—ã—Å—Ç—Ä–æ, –≤–∫—É—Å–Ω–æ –∏ —Å –¥—É—à–æ–π üî•üêî
–ì–æ—Ç–æ–≤–∏–º —Å–æ—á–Ω—É—é –∫—É—Ä–∏—Ü—É, –±—É—Ä–≥–µ—Ä—ã, —à–∞—É—Ä–º—É –∏ –ª—é–±–∏–º—ã–µ —Ñ–∞—Å—Ç—Ñ—É–¥-–±–ª—é–¥–∞ –∏–∑ —Å–≤–µ–∂–∏—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤.

–ó–∞–±—Ä–∞—Ç—å —Å —Å–æ–±–æ–π –∏–ª–∏ –∑–∞–∫–∞–∑–∞—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É ‚Äî –≤—ã–±–∏—Ä–∞–π –∫–∞–∫ —É–¥–æ–±–Ω–æ.
SHASH TOVUQ ‚Äî –∫–æ–≥–¥–∞ —Ö–æ—á–µ—Ç—Å—è –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É –≤–∫—É—Å–Ω–æ!

üìç –°–∞–º–∞—Ä–∫–∞–Ω–¥
(—É–∫–∞–∂–∏ –∞–¥—Ä–µ—Å –∑–¥–µ—Å—å)`,
  uz:`üá∫üáø Biz haqimizda

Fast Food SHASH TOVUQ ‚Äî tez, mazali va chin dildan üî•üêî
Biz shirali tovuq, burger, shaurma va sevimli fastfud taomlarini yangi mahsulotlardan tayyorlaymiz.

Olib ketish yoki yetkazib berish ‚Äî o'zingizga qulayini tanlang.
SHASH TOVUQ ‚Äî haqiqiy mazani xohlaganda!

üìç Samarqand
(manzilni shu yerga yozing)`,
  en:`üá¨üáß About Us

Fast Food SHASH TOVUQ ‚Äî fast, tasty, and made with care üî•üêî
We cook juicy chicken, burgers, shawarma and your favorite fast food using fresh ingredients.

Pickup or delivery ‚Äî choose what‚Äôs convenient.
SHASH TOVUQ ‚Äî when you want it truly delicious!

üìç Samarkand
(add your address here)`
};

const TEXT={
  ru:{delivery:'üöö –î–æ—Å—Ç–∞–≤–∫–∞',pickup:'üèÉ –°–∞–º–æ–≤—ã–≤–æ–∑',address:'üìç –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏',phone:'üìû –¢–µ–ª–µ—Ñ–æ–Ω',cart:'üõí –ö–æ—Ä–∑–∏–Ω–∞',order:'–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑',comment:'‚úçÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É',cash:'üíµ –ù–∞–ª–∏—á–Ω—ã–µ',click:'üí≥ CLICK',results:'–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞',popular:'üî• –ü–æ–ø—É–ª—è—Ä–Ω–æ–µ',empty:'–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è',cart_btn:'üõí –ö–æ—Ä–∑–∏–Ω–∞',sizes:'–†–∞–∑–º–µ—Ä'},
  uz:{delivery:'üöö Yetkazish',pickup:'üèÉ Olib ketish',address:'üìç Manzil',phone:'üìû Telefon',cart:'üõí Savat',order:'Buyurtma berish',comment:'‚úçÔ∏è Izoh',cash:'üíµ Naqd',click:'üí≥ CLICK',results:'Qidiruv natijalari',popular:'üî• Ommabop',empty:"Savat bo‚Äòsh",cart_btn:'üõí Savat',sizes:'Hajm'},
  en:{delivery:'üöö Delivery',pickup:'üèÉ Pickup',address:'üìç Address',phone:'üìû Phone',cart:'üõí Cart',order:'Place order',comment:'‚úçÔ∏è Comment',cash:'üíµ Cash',click:'üí≥ CLICK',results:'Search results',popular:'üî• Popular',empty:'Cart is empty',cart_btn:'üõí Cart',sizes:'Size'}
};

/* ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏: –ö–æ–º–±–æ/–ù–∞–ø–∏—Ç–∫–∏/–°–æ—É—Å/–ì–∞—Ä–Ω–∏—Ä ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–µ.
   ‚úÖ –í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –≤ –ö—É—Ä–∏—Ü–∞ (—Å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –∫–∞–∫ –ø—Ä–æ—Å–∏–ª). */
const CATS={
  ru:{chicken:'üêî –ö—É—Ä–∏—Ü–∞',combo:'üç± –ö–æ–º–±–æ',drinks:'ü•§ –ù–∞–ø–∏—Ç–∫–∏',sauce:'ü•´ –°–æ—É—Å',garnish:'üçü –ì–∞—Ä–Ω–∏—Ä'},
  uz:{chicken:"üêî Tovuq",combo:'üç± Kombo',drinks:'ü•§ Ichimliklar',sauce:'ü•´ Sous',garnish:'üçü Garnir'},
  en:{chicken:'üêî Chicken',combo:'üç± Combo',drinks:'ü•§ Drinks',sauce:'ü•´ Sauce',garnish:'üçü Side'}
};

/* ‚úÖ –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –ö—É—Ä–∏—Ü–∞ */
const SUBCATS = {
  chicken: ['lavash','pita','doner','burger','wings','sausages','shashlik','chicken_sets']
};
const SUBCATS_I18N = {
  ru:{
    lavash:'üåØ –õ–∞–≤–∞—à',
    pita:'ü•ô –ü–∏—Ç–∞',
    doner:'üåØ –î–æ–Ω–µ—Ä',
    burger:'üçî –ë—É—Ä–≥–µ—Ä',
    wings:'üçó –ö—Ä—ã–ª—ã—à–∫–∏',
    sausages:'üå≠ –ö–æ–ª–±–∞—Å–∫–∏',
    shashlik:'üç¢ –®–∞—à–ª—ã—á–æ–∫',
    chicken_sets:'üêî –®–∞—à—Ç–æ–≤—É–∫'
  },
  uz:{
    lavash:'üåØ Lavash',
    pita:'ü•ô Pita',
    doner:'üåØ Doner',
    burger:'üçî Burger',
    wings:"üçó Qanotchalar",
    sausages:'üå≠ Kolbaska',
    shashlik:'üç¢ Shashlik',
    chicken_sets:'üêî Shash tovuq'
  },
  en:{
    lavash:'üåØ Lavash',
    pita:'ü•ô Pita',
    doner:'üåØ Doner',
    burger:'üçî Burger',
    wings:'üçó Wings',
    sausages:'üå≠ Sausages',
    shashlik:'üç¢ Skewer',
    chicken_sets:'üêî Chicken pieces'
  }
};

/* ‚úÖ –ú–ï–ù–Æ
   - –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–∞–∑–º–µ—Ä–æ–≤ –¥–µ–ª–∞–µ–º –∫—Ä–∞—Å–∏–≤–æ —á–µ—Ä–µ–∑ "variants"
   - –û—Å—Ç—Ä–æ–µ: spicy:true -> –≤ –∫–∞—Ä—Ç–æ—á–∫–µ —Å–≤–µ—Ä—Ö—É üå∂Ô∏è
   - –ì–∞—Ä–Ω–∏—Ä/–°–æ—É—Å/–ù–∞–ø–∏—Ç–∫–∏/–ö–æ–º–±–æ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
*/
const MENU2 = {
  chicken:{
    /* –õ–∞–≤–∞—à (–æ–±—ã—á–Ω—ã–π + –æ—Å—Ç—Ä—ã–π) */
    lavash:[
      {
        id:'lavash_classic',
        img:'logo.png',
        n:{ru:'–õ–∞–≤–∞—à', uz:'Lavash', en:'Lavash'},
        variants:[{k:'M',p:25000},{k:'L',p:30000},{k:'XL',p:35000}]
      },
      {
        id:'lavash_spicy',
        img:'logo.png',
        spicy:true,
        n:{ru:'–û—Å—Ç—Ä—ã–π –õ–∞–≤–∞—à', uz:"Achchiq lavash", en:'Spicy lavash'},
        variants:[{k:'M',p:25000},{k:'L',p:30000},{k:'XL',p:35000}]
      }
    ],

    /* –ü–∏—Ç–∞ –∫—É—Ä–∏—Ü–∞ (–æ–±—ã—á–Ω–∞—è + –æ—Å—Ç—Ä–∞—è) */
    pita:[
      {
        id:'pita_classic',
        img:'logo.png',
        n:{ru:'–®–∞—É—Ä–º–∞ –≤ –ø–∏—Ç–µ', uz:"Pitadagi shaurma", en:'Shawarma in pita'},
        variants:[{k:'M',p:25000},{k:'L',p:30000},{k:'XL',p:35000}]
      },
      {
        id:'pita_spicy',
        img:'logo.png',
        spicy:true,
        n:{ru:'–û—Å—Ç—Ä–∞—è –®–∞—É—Ä–º–∞ –≤ –ø–∏—Ç–µ', uz:"Achchiq pitadagi shaurma", en:'Spicy shawarma in pita'},
        variants:[{k:'M',p:25000},{k:'L',p:30000},{k:'XL',p:35000}]
      }
    ],

    /* –î–æ–Ω–µ—Ä: –≤ –ø–∏—Ç–µ (–±–µ–∑ —Ä–∞–∑–º–µ—Ä–æ–≤) + –≤ —Ç–∞—Ä–µ–ª–∫–µ (M/L/XL) */
    doner:[
      {
        id:'doner_pita',
        img:'logo.png',
        n:{ru:'–î–æ–Ω–µ—Ä –≤ –ø–∏—Ç–µ', uz:"Pitadagi doner", en:'Doner in pita'},
        p:23000
      },
      {
        id:'doner_pita_spicy',
        img:'logo.png',
        spicy:true,
        n:{ru:'–û—Å—Ç—Ä—ã–π –î–æ–Ω–µ—Ä –≤ –ø–∏—Ç–µ', uz:"Achchiq pitadagi doner", en:'Spicy doner in pita'},
        p:23000
      },
      {
        id:'doner_plate',
        img:'logo.png',
        n:{ru:'–î–æ–Ω–µ—Ä –≤ —Ç–∞—Ä–µ–ª–∫–µ', uz:"Likopchadagi doner", en:'Doner plate'},
        variants:[{k:'M',p:25000},{k:'L',p:32000},{k:'XL',p:40000}]
      },
      {
        id:'doner_plate_spicy',
        img:'logo.png',
        spicy:true,
        n:{ru:'–û—Å—Ç—Ä—ã–π –î–æ–Ω–µ—Ä –≤ —Ç–∞—Ä–µ–ª–∫–µ', uz:"Achchiq doner (likopcha)", en:'Spicy doner plate'},
        variants:[{k:'M',p:25000},{k:'L',p:32000},{k:'XL',p:40000}]
      }
    ],

    /* –ë—É—Ä–≥–µ—Ä */
    burger:[
      {id:'ch_burger', p:25000, img:'logo.png', n:{ru:'–ö—É—Ä–∏–Ω—ã–π –ë—É—Ä–≥–µ—Ä', uz:'Tovuq burger', en:'Chicken burger'}}
    ],

    /* –ö—Ä—ã–ª—ã—à–∫–∏ */
    wings:[
      {id:'wings_1kg', p:75000, img:'logo.png', n:{ru:'–ö—Ä—ã–ª—ã—à–∫–∏ 1 –∫–≥', uz:'Qanot 1 kg', en:'Wings 1 kg'}}
    ],

    /* –ö–æ–ª–±–∞—Å–∫–∏ */
    sausages:[
      {id:'sausages_fries', p:40000, img:'logo.png', n:{ru:'–ö–æ–ª–±–∞—Å–∫–∏ + –§—Ä–∏', uz:'Kolbaska + fri', en:'Sausages + fries'}},
      {id:'sosiski_fries_pita', p:20000, img:'logo.png', n:{ru:'–°–æ—Å–∏—Å—å–∫–∏ + –§—Ä–∏ + –ü–∏—Ç–∞', uz:'Sosiska + fri + pita', en:'Sausage + fries + pita'}}
    ],

    /* –®–∞—à–ª—ã—á–æ–∫ */
    shashlik:[
      {id:'shashlik_fries_pita', p:32000, img:'logo.png', n:{ru:'–®–∞—à–ª—ã—á–æ–∫ + –§—Ä–∏ + –ü–∏—Ç–∞', uz:'Shashlik + fri + pita', en:'Chicken skewer + fries + pita'}}
    ],

    /* –®–∞—à—Ç–æ–≤—É–∫ (–ø–æ –∫—É—Å–∫–∞–º) */
    chicken_sets:[
      {id:'shashtovuq_2', p:22000, img:'logo.png', n:{ru:'–®–∞—à—Ç–æ–≤—É–∫ 2 –∫—É—Å–∫–∞', uz:'Shash tovuq 2 bo‚Äòlak', en:'Chicken 2 pcs'}},
      {id:'shashtovuq_3', p:27000, img:'logo.png', n:{ru:'–®–∞—à—Ç–æ–≤—É–∫ 3 –∫—É—Å–∫–∞', uz:'Shash tovuq 3 bo‚Äòlak', en:'Chicken 3 pcs'}},
      {id:'shashtovuq_4', p:32000, img:'logo.png', n:{ru:'–®–∞—à—Ç–æ–≤—É–∫ 4 –∫—É—Å–∫–∞', uz:'Shash tovuq 4 bo‚Äòlak', en:'Chicken 4 pcs'}},
      {id:'shashtovuq_5', p:37000, img:'logo.png', n:{ru:'–®–∞—à—Ç–æ–≤—É–∫ 5 –∫—É—Å–∫–æ–≤', uz:'Shash tovuq 5 bo‚Äòlak', en:'Chicken 5 pcs'}},
      {id:'shashtovuq_6', p:42000, img:'logo.png', n:{ru:'–®–∞—à—Ç–æ–≤—É–∫ 6 –∫—É—Å–∫–æ–≤', uz:'Shash tovuq 6 bo‚Äòlak', en:'Chicken 6 pcs'}}
    ]
  },

  /* ‚úÖ –û—Ç–¥–µ–ª—å–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –ö–æ–º–±–æ */
  combo:[
    {id:'combo_lavash', p:28000, img:'logo.png', n:{ru:'–õ–∞–≤–∞—à –ö–æ–º–±–æ', uz:'Lavash kombo', en:'Lavash combo'}}
  ],

  /* ‚úÖ –û—Ç–¥–µ–ª—å–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –ù–∞–ø–∏—Ç–∫–∏ (–æ—Å—Ç–∞–≤–∏–ª —Ç–æ, —á—Ç–æ –±—ã–ª–æ) */
  drinks:[
    {id:'drink_cola_05', p:12000, img:'logo.png', n:{ru:'Coca-Cola 0.5L', uz:'Coca-Cola 0.5L', en:'Coca-Cola 0.5L'}},
    {id:'drink_fanta_05',p:12000, img:'logo.png', n:{ru:'Fanta 0.5L',     uz:'Fanta 0.5L',     en:'Fanta 0.5L'}},
    {id:'drink_water',   p:6000,  img:'logo.png', n:{ru:'–í–æ–¥–∞ 0.5L',      uz:'Suv 0.5L',       en:'Water 0.5L'}},
    {id:'drink_tea',     p:8000,  img:'logo.png', n:{ru:'Ice Tea 0.5L',   uz:'Ice Tea 0.5L',   en:'Ice Tea 0.5L'}}
  ],

  /* ‚úÖ –û—Ç–¥–µ–ª—å–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –°–æ—É—Å (–æ—Å—Ç–∞–≤–∏–ª —Ç–æ, —á—Ç–æ –±—ã–ª–æ) */
  sauce:[
    {id:'sauce_ketchup', p:3000, img:'logo.png', n:{ru:'–ö–µ—Ç—á—É–ø', uz:'Ketchup', en:'Ketchup'}},
    {id:'sauce_garlic',  p:4000, img:'logo.png', n:{ru:'–ß–µ—Å–Ω–æ—á–Ω—ã–π —Å–æ—É—Å', uz:"Sarimsoq sous", en:'Garlic sauce'}}
  ],

  /* ‚úÖ –û—Ç–¥–µ–ª—å–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –ì–∞—Ä–Ω–∏—Ä (–≤–Ω–µ—Å —Ç–≤–æ–∏ –ø–æ–∑–∏—Ü–∏–∏) */
  garnish:[
    {id:'gar_fries_L',       p:10000, img:'logo.png', n:{ru:'–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å –§—Ä–∏ L',  uz:'Fri kartoshka L',  en:'French fries L'}},
    {id:'gar_fries_XL',      p:15000, img:'logo.png', n:{ru:'–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å –§—Ä–∏ XL', uz:'Fri kartoshka XL', en:'French fries XL'}},
    {id:'gar_fries_pita',    p:16000, img:'logo.png', n:{ru:'–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å –§—Ä–∏ + –ü–∏—Ç–∞', uz:'Fri + pita', en:'Fries + pita'}},
    {id:'gar_village',       p:20000, img:'logo.png', n:{ru:'–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å –ø–æ-–¥–µ—Ä–µ–≤–µ–Ω—Å–∫–∏', uz:'Qishloqcha kartoshka', en:'Country potatoes'}}
  ]
};

/* carousels ids (–º–æ–∂–µ—à—å –º–µ–Ω—è—Ç—å –∫–∞–∫ —Ö–æ—á–µ—à—å) */
const COMBO_IDS   = ['combo_lavash'];
const POPULAR_IDS = ['lavash_classic_M','pita_classic_M','doner_pita','ch_burger'];
const NEW_IDS     = ['lavash_spicy_M','pita_spicy_M','doner_plate_spicy_M','wings_1kg'];

/* utils */
function formatSum(x){
  const n = Number(x) || 0;
  return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,' ');
}
function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}
function highlight(text, q){
  const safe = escapeHtml(text);
  if(!q) return safe;
  const lower = safe.toLowerCase();
  const idx = lower.indexOf(q.toLowerCase());
  if(idx === -1) return safe;
  return safe.slice(0,idx) + `<mark>${safe.slice(idx, idx+q.length)}</mark>` + safe.slice(idx+q.length);
}

const tgUser = Telegram.WebApp.initDataUnsafe?.user || {};
const tg_username = tgUser.username || "";
const tg_first_name = tgUser.first_name || "";
const tg_id = tgUser.id || "";

/* sheets */
function openTopMenu(){ $('menuBackdrop').classList.add('show'); $('menuSheet').classList.add('show'); }
function closeTopMenu(){ $('menuBackdrop').classList.remove('show'); $('menuSheet').classList.remove('show'); }

function openSubcats(){ $('subcatBackdrop').classList.add('show'); $('subcatSheet').classList.add('show'); }
function closeSubcats(){ $('subcatBackdrop').classList.remove('show'); $('subcatSheet').classList.remove('show'); }

function toggleReviewWidget(){
  const w = $('reviewWidgetWrap');
  w.style.display = (!w.style.display || w.style.display === 'none') ? 'block' : 'none';
}
function openYandexReviews(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  try{ Telegram.WebApp.openLink(YANDEX_WIDGET_URL); }
  catch(_){ window.open(YANDEX_WIDGET_URL, "_blank"); }
}
function openInstagram(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  closeTopMenu();
  try{ Telegram.WebApp.openLink(IG_URL); }
  catch(_){ window.open(IG_URL, "_blank"); }
}

/* About/Legal */
let currentAboutLang = 'ru';
function openAbout(){
  closeTopMenu();
  $('aboutBackdrop').style.display = 'block';
  $('aboutSheet').style.display = 'block';
  $('aboutBackdrop').classList.add('show');
  $('aboutSheet').classList.add('show');
  setAboutLang(currentAboutLang);
}
function closeAbout(){
  $('aboutBackdrop').style.display = 'none';
  $('aboutSheet').style.display = 'none';
  $('aboutBackdrop').classList.remove('show');
  $('aboutSheet').classList.remove('show');
}
function openLegal(){
  closeTopMenu();
  const t = MENU_I18N[lang] || MENU_I18N.ru;
  $('legalTitle').innerText = t.legal_title || '–î–ª—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü';
  const body = {
    ru:`–°–≤—è–∑–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º\n\n–¢–µ–ª: ${LEGAL_PHONE}\n–ü–æ—á—Ç–∞: ${LEGAL_MAIL}`,
    uz:`Menejer bilan bog'lanish\n\nTel: ${LEGAL_PHONE}\nPochta: ${LEGAL_MAIL}`,
    en:`Contact manager\n\nPhone: ${LEGAL_PHONE}\nEmail: ${LEGAL_MAIL}`
  };
  $('legalBody').textContent = body[lang] || body.ru;

  $('legalBackdrop').style.display = 'block';
  $('legalSheet').style.display = 'block';
  $('legalBackdrop').classList.add('show');
  $('legalSheet').classList.add('show');
}
function closeLegal(){
  $('legalBackdrop').style.display = 'none';
  $('legalSheet').style.display = 'none';
  $('legalBackdrop').classList.remove('show');
  $('legalSheet').classList.remove('show');
}
function contactManager(){
  const link = `https://t.me/${ADMIN_TG_ID}`;
  try{ Telegram.WebApp.openLink(link); }catch(_){ window.open(link, "_blank"); }
}
function openTelLegal(){
  const tel = `tel:${LEGAL_PHONE.replace(/\s+/g,'')}`;
  try{ Telegram.WebApp.openLink(tel); }catch(_){ window.location.href = tel; }
}
function openMailLegal(){
  const mail = `mailto:${LEGAL_MAIL}`;
  try{ Telegram.WebApp.openLink(mail); }catch(_){ window.location.href = mail; }
}

/* theme */
let lang='ru', category='chicken', subcat='', type='delivery', payment='cash';
let cart = {};

/* ‚úÖ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ø–æ –±–∞–∑–æ–≤–æ–º—É –±–ª—é–¥—É */
const selectedSize = {}; // { baseId: 'M' }

function applyTheme(theme){
  document.body.setAttribute('data-theme', theme);
  localStorage.setItem('shashtovuq_theme', theme);
  const t = MENU_I18N[lang] || MENU_I18N.ru;
  $('themeMenuSub').innerText = (theme === 'dark') ? t.theme_dark : t.theme_light;
  try{
    Telegram.WebApp.setHeaderColor?.(theme === 'dark' ? '#121212' : '#fbf7ef');
    Telegram.WebApp.setBackgroundColor?.(theme === 'dark' ? '#121212' : '#fbf7ef');
  }catch(_){}
}
function toggleThemeFromMenu(){
  const cur = document.body.getAttribute('data-theme') || 'light';
  applyTheme(cur === 'dark' ? 'light' : 'dark');
}
function setAboutLang(l){
  currentAboutLang = l;
  $('aboutBody').textContent = ABOUT_TEXT[l] || ABOUT_TEXT.ru;
  $('tabRu').classList.toggle('active', l==='ru');
  $('tabUz').classList.toggle('active', l==='uz');
  $('tabEn').classList.toggle('active', l==='en');
}

/* burger i18n */
function applyBurgerI18n(){
  const t = MENU_I18N[lang] || MENU_I18N.ru;
  $('menuTitle').innerText = t.menu;
  $('mReviewTitle').innerText = t.review_title;
  $('mReviewSub').innerText = t.review_sub;
  $('mReviewHint').innerText = t.review_hint;
  $('mOpenReviewsBtn').innerText = t.open_reviews;
  $('mCallTitle').innerText = t.call;
  $('mInstaSub').innerText = t.insta_sub;
  $('mThemeTitle').innerText = t.theme;
  $('mThemeAction').innerText = t.theme_action;
  $('mAboutTitle').innerText = t.about;
  $('mAboutSub').innerText = t.about_sub;
  $('aboutTitle').innerText = t.about_title;
  $('mLegalTitle').innerText = t.legal_title;
  $('mLegalSub').innerText = t.legal_sub;

  $('comboTitle').innerText = t.combo;
  $('newTitle').innerText = t.new;
  $('subcatTitle').innerText = t.subcats;
}
function syncThemeLabel(){
  const t = MENU_I18N[lang] || MENU_I18N.ru;
  const cur = document.body.getAttribute('data-theme') || 'light';
  $('themeMenuSub').innerText = (cur === 'dark') ? t.theme_dark : t.theme_light;
}
function getName(it){
  return (it && it.n && it.n[lang]) ? it.n[lang] : (it?.n?.ru || it?.id || '');
}

/* ‚úÖ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ä–∞–∑–º–µ—Ä–æ–≤ –≤ "–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ" –ø–æ–∑–∏—Ü–∏–∏ */
const ITEM_BY_ID = {};
const BASE_BY_VID = {}; // variantId -> baseId
(function indexItems(){
  const pushItem = (it)=>{
    if(!it) return;

    if(Array.isArray(it.variants) && it.variants.length){
      // –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä
      if(!selectedSize[it.id]) selectedSize[it.id] = it.variants[0].k;

      it.variants.forEach(v=>{
        const vid = `${it.id}_${v.k}`;
        ITEM_BY_ID[vid] = {
          id: vid,
          base_id: it.id,
          vkey: v.k,
          p: v.p,
          img: it.img,
          spicy: !!it.spicy,
          n: it.n
        };
        BASE_BY_VID[vid] = it.id;
      });
    }else{
      ITEM_BY_ID[it.id] = it;
      BASE_BY_VID[it.id] = it.id;
    }
  };

  for(const cat in MENU2){
    const node = MENU2[cat];
    if(Array.isArray(node)){
      node.forEach(pushItem);
    }else{
      for(const sc in node){
        (node[sc]||[]).forEach(pushItem);
      }
    }
  }
})();

/* ‚úÖ –ø–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π variantId –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏ */
function getActiveIdForItem(it){
  if(Array.isArray(it.variants) && it.variants.length){
    const k = selectedSize[it.id] || it.variants[0].k;
    return `${it.id}_${k}`;
  }
  return it.id;
}
function getDisplayPriceForItem(it){
  const id = getActiveIdForItem(it);
  return ITEM_BY_ID[id]?.p || it.p || 0;
}

/* carousels render */
function miniCounterHTML(id, prefix){
  const key = `${prefix}_${id}`;
  return `
    <div class="mini-counter" onclick="event.stopPropagation()">
      <button onclick="event.stopPropagation(); chg('${id}',-1)">‚àí</button>
      <div class="mini-count" id="${key}">${cart[id]||0}</div>
      <button onclick="event.stopPropagation(); chg('${id}',1)">+</button>
    </div>
  `;
}
function imgClickAttr(src){
  const safe = String(src || 'logo.png').replace(/"/g,'&quot;');
  return `onclick="event.stopPropagation(); openImgModal('${safe}')"`;
}

function renderCombo(){
  $('comboRow').innerHTML = '';
  COMBO_IDS.forEach(id=>{
    const it = ITEM_BY_ID[id];
    if(!it) return;
    cart[id] = cart[id] || 0;
    const name = getName(it);
    $('comboRow').innerHTML += `
      <div class="combo-card" onclick="chg('${id}',1)">
        <div class="badge">üç±</div>
        <div class="combo-img">
          <img src="${it.img}" onerror="this.src='logo.png'" ${imgClickAttr(it.img)}>
        </div>
        <div class="combo-name">${escapeHtml(name)}</div>
        <div class="combo-price">${formatSum(it.p)} <small>—Å—É–º</small></div>
        ${miniCounterHTML(id,'cb')}
      </div>
    `;
  });
}
function renderPopular(){
  $('popularRow').innerHTML = '';
  POPULAR_IDS.forEach(id=>{
    const it = ITEM_BY_ID[id];
    if(!it) return;
    cart[id] = cart[id] || 0;
    const baseId = BASE_BY_VID[id] || id;
    const name = getName(it) + (it.vkey ? ` ${it.vkey}` : '');
    $('popularRow').innerHTML += `
      <div class="small-card" onclick="chg('${id}',1)">
        <div class="badge">üî•</div>
        <div class="small-img">
          <img src="${it.img}" onerror="this.src='logo.png'" ${imgClickAttr(it.img)}>
        </div>
        <div class="small-name">${escapeHtml(name)}</div>
        <div class="small-price">${formatSum(it.p)} <small>—Å—É–º</small></div>
        ${miniCounterHTML(id,'pp')}
      </div>
    `;
  });
}
function renderNew(){
  $('newRow').innerHTML = '';
  NEW_IDS.forEach(id=>{
    const it = ITEM_BY_ID[id];
    if(!it) return;
    cart[id] = cart[id] || 0;
    const name = getName(it) + (it.vkey ? ` ${it.vkey}` : '');
    $('newRow').innerHTML += `
      <div class="small-card" onclick="chg('${id}',1)">
        <div class="badge">‚ú®</div>
        <div class="small-img">
          <img src="${it.img}" onerror="this.src='logo.png'" ${imgClickAttr(it.img)}>
        </div>
        <div class="small-name">${escapeHtml(name)}</div>
        <div class="small-price">${formatSum(it.p)} <small>—Å—É–º</small></div>
        ${miniCounterHTML(id,'nw')}
      </div>
    `;
  });
}
function syncCarouselCounts(id){
  ['cb_'+id,'pp_'+id,'nw_'+id].forEach(k=>{
    const el = document.getElementById(k);
    if(el) el.innerText = cart[id]||0;
  });
}

/* categories */
function renderCats(){
  $('cats').innerHTML='';
  const order = ['chicken','combo','drinks','sauce','garnish'];
  order.forEach(k=>{
    $('cats').innerHTML += `<button class="btn ${k===category?'active':''}" onclick="setCategory('${k}')">${CATS[lang][k] || k}</button>`;
  });
}

/* subcats sheet */
function renderSubcatsSheet(){
  const grid = $('subcatGrid');
  grid.innerHTML = '';
  const list = SUBCATS[category];
  if(!list || list.length === 0){
    closeSubcats();
    return;
  }
  list.forEach(sc=>{
    const label = (SUBCATS_I18N[lang] && SUBCATS_I18N[lang][sc]) ? SUBCATS_I18N[lang][sc] : sc;
    const active = (sc === subcat) ? 'active' : '';
    grid.innerHTML += `
      <div class="subcat-item ${active}" onclick="setSubcat('${sc}')">
        <div class="subcat-ic">${label.split(' ')[0] || 'üçΩÔ∏è'}</div>
        <div class="subcat-name">${escapeHtml(label.replace(/^[^\s]+\s?/, ''))}</div>
      </div>
    `;
  });
}
function setCategory(cat){
  category = cat;

  // ‚úÖ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–ª—å–∫–æ –≤ chicken
  const list = SUBCATS[category];
  subcat = (list && list.length) ? list[0] : '';

  renderCats();
  renderSubcatsSheet();
  renderProducts();

  if(list && list.length) openSubcats(); else closeSubcats();
  if(isSearchOpen()) closeSearch();
}
function setSubcat(sc){
  subcat = sc;
  renderSubcatsSheet();
  renderProducts();
  closeSubcats();
}

/* products */
function sizeRowHTML(baseItem){
  if(!Array.isArray(baseItem.variants) || !baseItem.variants.length) return '';
  const cur = selectedSize[baseItem.id] || baseItem.variants[0].k;
  return `
    <div class="size-row" onclick="event.stopPropagation()">
      ${baseItem.variants.map(v=>{
        const act = (v.k === cur) ? 'active' : '';
        return `<div class="size-chip ${act}" onclick="event.stopPropagation(); setSize('${baseItem.id}','${v.k}')">${escapeHtml(v.k)}</div>`;
      }).join('')}
    </div>
  `;
}
function setSize(baseId, k){
  selectedSize[baseId] = k;

  // –æ–±–Ω–æ–≤–∏—Ç—å —Ü–µ–Ω—É –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ –∏ —Å—á–µ—Ç—á–∏–∫ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞
  renderProducts();
  if(isSearchOpen()) searchProducts();

  // –∫–∞—Ä—É—Å–µ–ª–∏ –Ω–µ —Ç—Ä–æ–≥–∞–µ–º (—Ç–∞–º —É–∂–µ variantId —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
  updateTotal();
}

function cardHTML(baseItem, q=''){
  const name = getName(baseItem);
  const nameHtml = highlight(name, q);

  const activeId = getActiveIdForItem(baseItem);
  const priceNow = getDisplayPriceForItem(baseItem);
  const spicy = !!baseItem.spicy;

  cart[activeId] = cart[activeId] || 0;

  return `<div class="card">
    ${spicy ? `<div class="spicy-badge">üå∂Ô∏è</div>` : ``}
    <div class="img">
      <img src="${baseItem.img}" onerror="this.src='logo.png'" onclick="event.stopPropagation(); openImgModal('${String(baseItem.img||'logo.png').replace(/'/g,"\\'")}')">
    </div>
    <div>${nameHtml}</div>
    ${sizeRowHTML(baseItem)}
    <div class="price">${formatSum(priceNow)} <small>—Å—É–º</small></div>
    <div class="counter">
      <button onclick="chg('${activeId}',-1)">‚àí</button>
      <span id="c_${activeId}">${cart[activeId]||0}</span>
      <button onclick="chg('${activeId}',1)">+</button>
    </div>
  </div>`;
}

function getCurrentItems(){
  const node = MENU2[category];
  if(!node) return [];
  if(Array.isArray(node)) return node;          // combo/drinks/sauce/garnish
  return node[subcat] || [];                    // chicken -> subcats
}

function renderProducts(){
  $('products').innerHTML='';
  const items = getCurrentItems();
  items.forEach(it=>{
    // –¥–ª—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–∑–æ–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É, –∫–æ—Ä–∑–∏–Ω–∞ —Ö—Ä–∞–Ω–∏—Ç variantId
    $('products').innerHTML += cardHTML(it,'');
  });
}

/* cart */
function chg(id,v){
  cart[id]=Math.max(0,(cart[id]||0)+v);
  const el = document.getElementById('c_'+id);
  if(el) el.innerText=cart[id];
  syncCarouselCounts(id);
  updateTotal();
}
function price(id){ return ITEM_BY_ID[id]?.p || 0; }
function updateTotal(){
  let s=0;
  for(let id in cart) s += (cart[id]||0) * price(id);
  $('total').innerText = formatSum(s);
  $('stickyTotal').innerText = formatSum(s);
}

/* type/payment */
function applyTypeUI(){
  if(type === 'pickup'){
    $('address').style.display = 'none';
    $('address').value = '';
  } else {
    $('address').style.display = 'block';
  }
}
function setType(t,b){
  if(isSearchOpen()) closeSearch();
  type=t;
  document.querySelectorAll('.types .btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  applyTypeUI();
}
function setPayment(p){
  payment=p;
  $('payCash').classList.toggle('active',p==='cash');
  $('payClick').classList.toggle('active',p==='click');
}
function scrollToCart(){
  closeTopMenu();
  const el = $('cartBlock');
  if(!el) return;
  el.scrollIntoView({behavior:'smooth', block:'start'});
}

/* search */
function isSearchOpen(){ return $('searchWrap').classList.contains('show'); }
function toggleSearch(){ isSearchOpen() ? closeSearch() : openSearch(); }
function openSearch(){
  $('searchWrap').classList.add('show');
  $('searchTitle').classList.add('show');
  $('cats').style.display = 'none';
  $('comboWrap').style.display = 'none';
  $('popularWrap').style.display = 'none';
  $('newWrap').style.display = 'none';
  $('searchInput').value = '';
  $('searchInput').focus();
  searchProducts();
}
function closeSearch(){
  $('searchWrap').classList.remove('show');
  $('searchTitle').classList.remove('show');
  $('cats').style.display = '';
  $('comboWrap').style.display = '';
  $('popularWrap').style.display = '';
  $('newWrap').style.display = '';
  $('searchInput').value = '';
  renderProducts();
}
function clearSearch(){ closeSearch(); }
function onSearchKey(e){ if(e.key === 'Enter') closeSearch(); }

function searchProducts(){
  const q = ($('searchInput').value || '').trim().toLowerCase();
  $('products').innerHTML='';
  if(!q){ renderProducts(); return; }

  const matchBase = (base)=>{
    const name = getName(base);
    const n_ru = (base.n?.ru||'').toLowerCase();
    const n_uz = (base.n?.uz||'').toLowerCase();
    const n_en = (base.n?.en||'').toLowerCase();
    const n_cur = String(name).toLowerCase();
    return (n_cur.includes(q) || n_ru.includes(q) || n_uz.includes(q) || n_en.includes(q));
  };

  for(const cat in MENU2){
    const node = MENU2[cat];
    if(Array.isArray(node)){
      node.forEach(base=>{
        if(matchBase(base)) $('products').innerHTML += cardHTML(base, q);
      });
    }else{
      for(const sc in node){
        (node[sc]||[]).forEach(base=>{
          if(matchBase(base)) $('products').innerHTML += cardHTML(base, q);
        });
      }
    }
  }
}

/* order payload */
function genOrderId(){
  const d = new Date();
  const dd = String(d.getDate()).padStart(2,'0');
  const mm = String(d.getMonth()+1).padStart(2,'0');
  const key = `shashtovuq_seq_${d.getFullYear()}${mm}${dd}`;
  let n = Number(localStorage.getItem(key) || 0) + 1;
  localStorage.setItem(key, String(n));
  return `ST-${dd}${mm}-${String(n).padStart(3,'0')}`;
}
function calcTotalNum(){
  let s = 0;
  for (const id in cart) s += (Number(cart[id] || 0) * price(id));
  return s;
}
function buildOrderLines(){
  const lines = [];
  for(const id in cart){
    const qty = Number(cart[id]||0);
    if(qty<=0) continue;
    const it = ITEM_BY_ID[id];
    if(!it) continue;

    const baseName = getName(it);
    const nameWithSize = it.vkey ? `${baseName} ${it.vkey}` : baseName;

    lines.push({ id, name: nameWithSize, qty, price: it.p, sum: it.p * qty, spicy: !!it.spicy });
  }
  return lines;
}
function sendOrder(){
  const cleanOrder = {};
  for (const id in cart) {
    const q = Number(cart[id] || 0);
    if (q > 0) cleanOrder[id] = q;
  }
  if (Object.keys(cleanOrder).length === 0) {
    alert(TEXT[lang].empty);
    return;
  }

  const payload = {
    tg: { id: tg_id, username: tg_username, first_name: tg_first_name },
    lang,
    items: buildOrderLines(),
    order: cleanOrder,
    total: $('total').innerText,
    total_num: calcTotalNum(),
    payment,
    type,
    address: type === 'pickup' ? '' : $('address').value,
    phone: $('phone').value,
    comment: $('comment').value,
    order_id: genOrderId(),
    ui: { category, subcat }
  };

  Telegram.WebApp.sendData(JSON.stringify(payload));
  Telegram.WebApp.close();
}

/* apply lang */
function setLang(l,b){
  lang=l;
  document.querySelectorAll('.langs .btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  applyLang();
}
function applyLang(){
  $('btnDelivery').innerText = TEXT[lang].delivery;
  $('btnPickup').innerText   = TEXT[lang].pickup;
  $('address').placeholder   = TEXT[lang].address;
  $('phone').placeholder     = TEXT[lang].phone;
  $('cartTitle').innerText   = TEXT[lang].cart;
  $('orderBtn').innerText    = TEXT[lang].order;
  $('comment').placeholder   = TEXT[lang].comment;
  $('payCash').innerText     = TEXT[lang].cash;
  $('payClick').innerText    = TEXT[lang].click;
  $('searchTitle').innerText = TEXT[lang].results;
  $('popularTitle').innerText= TEXT[lang].popular;
  $('stickyCart').innerText  = TEXT[lang].cart_btn;

  applyBurgerI18n();
  syncThemeLabel();

  renderCats();
  renderSubcatsSheet();
  renderProducts();

  renderCombo();
  renderPopular();
  renderNew();

  updateTotal();
  applyTypeUI();
}

/* saved inputs */
function loadSaved(){
  const a = localStorage.getItem("shashtovuq_address") || '';
  const p = localStorage.getItem("shashtovuq_phone") || '';
  if(a && !$('address').value) $('address').value = a;
  if(p && !$('phone').value) $('phone').value = p;
}
function bindSave(){
  $('address').addEventListener('input', ()=>localStorage.setItem("shashtovuq_address", $('address').value));
  $('phone').addEventListener('input', ()=>localStorage.setItem("shashtovuq_phone", $('phone').value));
}

/* init theme */
(function initTheme(){
  const saved = localStorage.getItem('shashtovuq_theme');
  if(saved === 'dark' || saved === 'light') applyTheme(saved);
  else{
    const tgTheme = Telegram.WebApp.colorScheme || 'light';
    applyTheme(tgTheme === 'dark' ? 'dark' : 'light');
  }
})();

/* defaults */
(function initDefaults(){
  category = 'chicken';
  subcat = (SUBCATS[category] && SUBCATS[category].length) ? SUBCATS[category][0] : '';
})();

loadSaved();
bindSave();
applyLang();
setAboutLang('ru');
</script>
</body>
</html>
